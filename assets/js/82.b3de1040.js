(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{478:function(e,r,v){"use strict";v.r(r);var t=v(10),s=Object(t.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"zeppelin-v0-8分片方案"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#zeppelin-v0-8分片方案"}},[e._v("$")]),e._v(" Zeppelin v0.8分片方案")]),e._v(" "),r("h3",{attrs:{id:"目标"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[e._v("$")]),e._v(" 目标")]),e._v(" "),r("p",[e._v("尽量将paragraph的执行均衡分布到多台机器执行，对运行超过一定时间的任务及时释放解释器资源。")]),e._v(" "),r("h3",{attrs:{id:"方案"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#方案"}},[e._v("$")]),e._v(" 方案")]),e._v(" "),r("ol",[r("li",[e._v("一个note只对应唯一的用户,同一个note不为多用户保留各自的状态")]),e._v(" "),r("li",[e._v("interpreter都配置为peruser,pernote,保证一个note和一个interpreter关联,interpreter资源释放不影响其他note")]),e._v(" "),r("li",[e._v("因为一个note同一种类型的paragraph会有上下文关联，所以要代理到同一个zeppelin server上执行；不同类型的paragraph可以代理到不同的zeppelin server")]),e._v(" "),r("li",[e._v("note仓库配置为mongodb存储")]),e._v(" "),r("li",[e._v("文本类操作执行后刷新全部server的note仓库，保证所有server的note仓库是同步的")]),e._v(" "),r("li",[e._v("对于运行类操作（运行，停止，运行全部，停止全部，清空所有结果）会记录最后运行时间和当前sever")]),e._v(" "),r("li",[e._v("一个note的某个类型的paragraph超过2小时没有运行过则重新分配到负载低的server")]),e._v(" "),r("li",[e._v("为了保证重新分配server后还能获取到上次的运行结果，获取结果的API要代理到上次运行的server上")])]),e._v(" "),r("h3",{attrs:{id:"测试方案"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#测试方案"}},[e._v("$")]),e._v(" 测试方案")]),e._v(" "),r("ol",[r("li",[e._v("代理在一台server上时，文本类操作和运行类操作是否正常")]),e._v(" "),r("li",[e._v("2小时过期后是否能切换到负载低的server上")]),e._v(" "),r("li",[e._v("server切换后能否获取到上次运行的结果")]),e._v(" "),r("li",[e._v("server切换后，文本类操作和运行类操作是否正常")]),e._v(" "),r("li",[e._v("一个note包含多种类型的paragraph是否正常代理到不同的server")]),e._v(" "),r("li",[e._v("server扩容缩容是否正常")]),e._v(" "),r("li",[e._v("有大量并发任务的时候是否正常")])]),e._v(" "),r("h3",{attrs:{id:"实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[e._v("$")]),e._v(" 实现")]),e._v(" "),r("ol",[r("li",[e._v("路由表记录"),r("code",[e._v("note:type")]),e._v("指向的server")]),e._v(" "),r("li",[e._v("运行类操作（运行，停止，运行全部，停止全部，清空所有结果）每次会记录last server和最后运行时间")]),e._v(" "),r("li",[e._v("result和status请求直接从last server代理")]),e._v(" "),r("li",[e._v("运行时发现当前server过期或宕机则重新分配代理server；如果server宕机则记录机器不可用")]),e._v(" "),r("li",[e._v("使用默认的LifeCycleManager管理解释器的生命周期（超过2小时自动释放）")]),e._v(" "),r("li",[e._v("note仓库配置为mongodb存储")]),e._v(" "),r("li",[e._v("文本类操作执行后刷新全部server的note仓库，保证所有server的note仓库是同步的")])])])}),[],!1,null,null,null);r.default=s.exports}}]);