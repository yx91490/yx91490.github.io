(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{468:function(a,t,e){"use strict";e.r(t);var s=e(10),r=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"zeppelin使用趟坑"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zeppelin使用趟坑"}},[a._v("$")]),a._v(" zeppelin使用趟坑")]),a._v(" "),t("h3",{attrs:{id:"环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[a._v("$")]),a._v(" 环境")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("组件")]),a._v(" "),t("th",[a._v("版本")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("zeppelin")]),a._v(" "),t("td",[a._v("0.8.0")])]),a._v(" "),t("tr",[t("td",[a._v("CDH")]),a._v(" "),t("td",[a._v("5.15")])]),a._v(" "),t("tr",[t("td",[a._v("spark")]),a._v(" "),t("td",[a._v("2.3.0")])]),a._v(" "),t("tr",[t("td",[a._v("python")]),a._v(" "),t("td",[a._v("3.6.5")])])])]),a._v(" "),t("h3",{attrs:{id:"pyspark"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pyspark"}},[a._v("$")]),a._v(" PySpark")]),a._v(" "),t("h4",{attrs:{id:"netty包版本冲突"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#netty包版本冲突"}},[a._v("$")]),a._v(" netty包版本冲突")]),a._v(" "),t("p",[a._v("pyspark不能运行，产生下面的"),t("code",[a._v("NoSuchMethodError")]),a._v("异常：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("WARN [2018-12-14 14:14:40,397] ({pool-2-thread-67} NotebookServer.java[afterStatusChange]:2302) - Job 20181204-201952_953985087 is finished, status: ERROR, exception: null, result: %text java.lang.NoSuchMethodError: io.netty.buffer.PooledByteBufAllocator.metric()Lio/netty/buffer/PooledByteBufAllocatorMetric;\n            at org.apache.spark.network.util.NettyMemoryMetrics.registerMetrics(NettyMemoryMetrics.java:80)\n            at org.apache.spark.network.util.NettyMemoryMetrics.<init>(NettyMemoryMetrics.java:76)\n            at org.apache.spark.network.client.TransportClientFactory.<init>(TransportClientFactory.java:109)\n            at org.apache.spark.network.TransportContext.createClientFactory(TransportContext.java:99)\n            ...//堆栈信息\n            at org.apache.zeppelin.spark.BaseSparkScalaInterpreter.spark2CreateContext(BaseSparkScalaInterpreter.scala:189)\n")])])]),t("p",[a._v("大致原因是zeppelin的"),t("code",[a._v("netty-all")]),a._v("包版本比spark的版本低，将zeppelin的lib目录里的"),t("code",[a._v("netty-all-4.0.23.Final.jar")]),a._v("替换成"),t("code",[a._v("netty-all-4.1.17.Final.jar")]),a._v("解决，但是又产生下面的异常：")]),a._v(" "),t("h4",{attrs:{id:"jackson包版本冲突"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jackson包版本冲突"}},[a._v("$")]),a._v(" jackson包版本冲突")]),a._v(" "),t("p",[a._v("异常信息如下：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("com.fasterxml.jackson.databind.JsonMappingException: Incompatible Jackson version: 2.8.11-1\n       at com.fasterxml.jackson.module.scala.JacksonModule$class.setupModule(JacksonModule.scala:64)\n       at com.fasterxml.jackson.module.scala.DefaultScalaModule.setupModule(DefaultScalaModule.scala:19)\n       at com.fasterxml.jackson.databind.ObjectMapper.registerModule(ObjectMapper.java:747)\n       at org.apache.spark.util.JsonProtocol$.<init>(JsonProtocol.scala:59)\n       at org.apache.spark.util.JsonProtocol$.<clinit>(JsonProtocol.scala)\n")])])]),t("p",[a._v("zeppelin使用的"),t("code",[a._v("jackson-databind")]),a._v("包的版本是"),t("code",[a._v("2.8.11.1")]),a._v("，换成"),t("code",[a._v("2.6.7.1")]),a._v("问题解决。")]),a._v(" "),t("h4",{attrs:{id:"commons-lang3包版本冲突"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#commons-lang3包版本冲突"}},[a._v("$")]),a._v(" commons-lang3包版本冲突")]),a._v(" "),t("p",[a._v("运行下面的代码：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('%spark.pyspark\ndf = spark.read.format("csv").option("header", "true").load("test.csv")\nprint(df.show(5))\n')])])]),t("p",[a._v("使用pyspark读取csv文件到dataframe中，当调用"),t("code",[a._v("df.show()")]),a._v("后产生如下异常：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("java.io.InvalidClassException: org.apache.commons.lang3.time.FastDateParser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v(" class incompatible: stream classdesc serialVersionUID "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(", "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v(" class serialVersionUID "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n\tat java.io.ObjectStreamClass.initNonProxy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ObjectStreamClass.java:621"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\tat java.io.ObjectInputStream.readNonProxyDesc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ObjectInputStream.java:1623"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\tat java.io.ObjectInputStream.readClassDesc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ObjectInputStream.java:1518"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".//堆栈信息\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("class "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'py4j.protocol.Py4JJavaError'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(", Py4JJavaError"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'An error occurred while calling o98.showString.\\n'")]),a._v(", JavaObject "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("o100"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("traceback object at 0x7faeb0e5604"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("8")]),a._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\t\n")])])]),t("p",[a._v("大致原因是类FastDateParser序列化时的serialVersionUID是2，而反序列化时serialVersionUID是3，查看发现zeppelin使用的commons-lang3包的版本是3.4，而spark使用的是3.5，把zeppelin的包替换成3.5后此问题解决。")]),a._v(" "),t("h3",{attrs:{id:"开发环境配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开发环境配置"}},[a._v("$")]),a._v(" 开发环境配置")]),a._v(" "),t("h4",{attrs:{id:"编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[a._v("$")]),a._v(" 编译")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("# zeppelin 0.9 maven编译参数\nmvn clean install -DskipTests -Drat.skip=true -Dcheckstyle.skip -pl '!groovy,!angular,!shell,!livy,!hbase,!pig,!jdbc,!file,!flink,!ignite,!kylin,!lens,!cassandra,!elasticsearch,!bigquery,!alluxio,!scio,!neo4j,!sap,!scalding,!java,!beam,!hazelcastjet,!geode' -Pscala-2.11 -Pspark-2.3 -Dhadoop.version=2.6.0-cdh5.15.0\n")])])]),t("h4",{attrs:{id:"maven-checkstyle插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#maven-checkstyle插件"}},[a._v("$")]),a._v(" maven CheckStyle插件")]),a._v(" "),t("p",[a._v("略过checkstyle检查：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("mvn [goal] -Dcheckstyle.skip\n")])])]),t("p",[a._v("IDE插件：")]),a._v(" "),t("ol",[t("li",[a._v("安装"),t("a",{attrs:{href:"https://plugins.jetbrains.com/plugin/1065-checkstyle-idea",target:"_blank",rel:"noopener noreferrer"}},[a._v("CheckStyle IDEA plugin"),t("OutboundLink")],1),a._v(".")]),a._v(" "),t("li",[t("a",{attrs:{href:"https://stackoverflow.com/a/35273850/2062384",target:"_blank",rel:"noopener noreferrer"}},[a._v("把配置引入编辑器"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("参考：")]),a._v(" "),t("blockquote",[t("p",[a._v("https://stackoverflow.com/questions/8409074/how-can-i-easily-fix-checkstyle-errors/8417213#8417213")]),a._v(" "),t("p",[a._v("https://stackoverflow.com/questions/35149422/how-to-fix-the-maven-check-style-error/35149647")])])])}),[],!1,null,null,null);t.default=r.exports}}]);