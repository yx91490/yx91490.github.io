(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{483:function(t,e,a){"use strict";a.r(e);var v=a(10),_=Object(v.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"zookeeper笔记"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper笔记"}},[t._v("$")]),t._v(" ZooKeeper笔记")]),t._v(" "),e("h2",{attrs:{id:"api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#api"}},[t._v("$")]),t._v(" API")]),t._v(" "),e("h3",{attrs:{id:"watchedevent"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#watchedevent"}},[t._v("$")]),t._v(" WatchedEvent")]),t._v(" "),e("ul",[e("li",[t._v("keeperState")]),t._v(" "),e("li",[t._v("eventType")]),t._v(" "),e("li",[t._v("path")])]),t._v(" "),e("h3",{attrs:{id:"keeperstate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#keeperstate"}},[t._v("$")]),t._v(" KeeperState")]),t._v(" "),e("ul",[e("li",[t._v("Disconnected")]),t._v(" "),e("li",[t._v("SyncConnected             客户端连接到其中一台Server")]),t._v(" "),e("li",[t._v("ConnectedReadOnly    客户端连接到一台只读的Server")]),t._v(" "),e("li",[t._v("AuthFailed")]),t._v(" "),e("li",[t._v("SaslAuthenticated")]),t._v(" "),e("li",[t._v("Expired                           需要创建新的ZooKeeper实例")])]),t._v(" "),e("h3",{attrs:{id:"eventtype"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#eventtype"}},[t._v("$")]),t._v(" EventType")]),t._v(" "),e("ul",[e("li",[t._v("None")]),t._v(" "),e("li",[t._v("NodeCreated")]),t._v(" "),e("li",[t._v("NodeDeleted")]),t._v(" "),e("li",[t._v("NodeDataChanged")]),t._v(" "),e("li",[t._v("NodeChildrenChanged")])]),t._v(" "),e("h3",{attrs:{id:"create-string-path-byte-data-list-acl-acl-createmode-mode"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-string-path-byte-data-list-acl-acl-createmode-mode"}},[t._v("$")]),t._v(" create(String path, byte data[], List<ACL> acl, CreateMode mode)")]),t._v(" "),e("p",[t._v("异步版本：create(String path, byte data[], List<ACL> acl, CreateMode mode,  StringCallback cb, Object ctx)")]),t._v(" "),e("p",[t._v("异常：")]),t._v(" "),e("ul",[e("li",[t._v("KeeperException.NodeExists 节点已存在")]),t._v(" "),e("li",[t._v("KeeperException.NoNode 父节点不存在")]),t._v(" "),e("li",[t._v("KeeperException.NoChildrenForEphemerals 临时节点不能创建子节点")])]),t._v(" "),e("p",[t._v("临时节点会在会话过期后自动删除")]),t._v(" "),e("p",[t._v("有序节点实际路径名是给定的路径前缀加上一个数字，数字始终是0填充的10位数。")]),t._v(" "),e("p",[t._v("操作成功后会触发该路径上由"),e("code",[t._v("exists()")]),t._v("和"),e("code",[t._v("getData()")]),t._v("方法产生的监视点，以及父节点由"),e("code",[t._v("getChildren()")]),t._v("方法产生的监视点")]),t._v(" "),e("p",[t._v("节点创建成功后，服务端会触发该路径上由"),e("code",[t._v("exists()")]),t._v("方法产生的监视点，以及父节点由"),e("code",[t._v("getChildren()")]),t._v("方法产生的监视点")]),t._v(" "),e("p",[t._v("数据最大为1MB")]),t._v(" "),e("h3",{attrs:{id:"delete-string-path-int-version"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#delete-string-path-int-version"}},[t._v("$")]),t._v(" delete(String path, int version)")]),t._v(" "),e("p",[t._v("异步版本：delete(final String path, int version, VoidCallback cb, Object ctx)")]),t._v(" "),e("p",[t._v("异常：")]),t._v(" "),e("ul",[e("li",[t._v("KeeperException.NoNode")]),t._v(" "),e("li",[t._v("KeeperException.BadVersion")]),t._v(" "),e("li",[t._v("KeeperException.NotEmpty 子节点不为空")])]),t._v(" "),e("p",[t._v("如果version为-1则匹配所有节点版本。")]),t._v(" "),e("p",[t._v("操作成功后会触发该路径上由"),e("code",[t._v("exists()")]),t._v("方法产生的监视点，以及父节点由"),e("code",[t._v("getChildren()")]),t._v("方法产生的监视点")]),t._v(" "),e("h3",{attrs:{id:"exists-string-path-boolean-watch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#exists-string-path-boolean-watch"}},[t._v("$")]),t._v(" Exists(String path, boolean watch)")]),t._v(" "),e("p",[t._v("异步版本：exists(String path, boolean watch, StatCallback cb, Object ctx)")]),t._v(" "),e("p",[t._v("节点不存在返回null")]),t._v(" "),e("p",[t._v("如果"),e("code",[t._v("watch")]),t._v("为true并且成功返回则会创建一个监视点，当节点创建、删除或者设置节点数据的时候会被触发。")]),t._v(" "),e("h3",{attrs:{id:"getchildren-string-path-boolean-watch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getchildren-string-path-boolean-watch"}},[t._v("$")]),t._v(" getChildren(String path, boolean watch)")]),t._v(" "),e("p",[t._v("异步版本：getChildren(String path, boolean watch, ChildrenCallback cb, Object ctx)")]),t._v(" "),e("p",[t._v("异常：")]),t._v(" "),e("ul",[e("li",[t._v("KeeperException.NoNode")])]),t._v(" "),e("p",[t._v("如果"),e("code",[t._v("watch")]),t._v("为true并且成功返回则会创建一个监视点，当节点删除或者子节点创建、删除的时候会被触发。")]),t._v(" "),e("p",[t._v("返回列表顺序没有保证")]),t._v(" "),e("h3",{attrs:{id:"getdata-string-path-boolean-watch-stat-stat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getdata-string-path-boolean-watch-stat-stat"}},[t._v("$")]),t._v(" getData(String path, boolean watch, Stat stat)")]),t._v(" "),e("p",[t._v("异步版本：getData(String path, boolean watch, DataCallback cb, Object ctx)")]),t._v(" "),e("p",[t._v("异常：")]),t._v(" "),e("ul",[e("li",[t._v("KeeperException.NoNode")])]),t._v(" "),e("p",[t._v("如果"),e("code",[t._v("watch")]),t._v("为true并且成功返回则会创建一个监视点，当 设置节点数据或节点被删除的时候会被触发。")]),t._v(" "),e("h3",{attrs:{id:"setdata-string-path-byte-data-int-version"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setdata-string-path-byte-data-int-version"}},[t._v("$")]),t._v(" setData(String path, byte data[], int version)")]),t._v(" "),e("p",[t._v("异常：")]),t._v(" "),e("ul",[e("li",[t._v("KeeperException.NoNode")]),t._v(" "),e("li",[t._v("KeeperException.BadVersion")])]),t._v(" "),e("p",[t._v("如果version为-1则匹配所有节点版本。")]),t._v(" "),e("p",[t._v("数据最大为1MB")]),t._v(" "),e("h3",{attrs:{id:"回调函数处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#回调函数处理"}},[t._v("$")]),t._v(" 回调函数处理")]),t._v(" "),e("p",[t._v("为了保持顺序，异步调用会在单独的一个线程中按照响应的接收顺序处理响应包。因此一般不要在回调函数中集中操作或阻塞操作。")]),t._v(" "),e("h2",{attrs:{id:"管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#管理"}},[t._v("$")]),t._v(" 管理")]),t._v(" "),e("p",[t._v("ZooKeeper有两种管理接口：JMX和四字母组成的命令。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ telnet 127.0.0.1 2181\ntelnet> stat\ntelnet> dump\n")])])]),e("h2",{attrs:{id:"acl"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#acl"}},[t._v("$")]),t._v(" ACL")]),t._v(" "),e("p",[t._v("总体来说，ZK的节点有5种操作权限：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("权限")]),t._v(" "),e("th",[t._v("名称")]),t._v(" "),e("th",[t._v("简写")]),t._v(" "),e("th",[t._v("生效范围")]),t._v(" "),e("th",[t._v("权限值")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("READ")]),t._v(" "),e("td",[t._v("查")]),t._v(" "),e("td",[t._v("r")]),t._v(" "),e("td",[t._v("节点自身")]),t._v(" "),e("td",[t._v("1")])]),t._v(" "),e("tr",[e("td",[t._v("WRITE")]),t._v(" "),e("td",[t._v("改")]),t._v(" "),e("td",[t._v("w")]),t._v(" "),e("td",[t._v("节点自身")]),t._v(" "),e("td",[t._v("2")])]),t._v(" "),e("tr",[e("td",[t._v("CREATE")]),t._v(" "),e("td",[t._v("增")]),t._v(" "),e("td",[t._v("c")]),t._v(" "),e("td",[t._v("子节点?")]),t._v(" "),e("td",[t._v("4")])]),t._v(" "),e("tr",[e("td",[t._v("DELETE")]),t._v(" "),e("td",[t._v("删")]),t._v(" "),e("td",[t._v("d")]),t._v(" "),e("td",[t._v("子节点")]),t._v(" "),e("td",[t._v("8")])]),t._v(" "),e("tr",[e("td",[t._v("ADMIN")]),t._v(" "),e("td",[t._v("管理")]),t._v(" "),e("td",[t._v("a")]),t._v(" "),e("td",[t._v("节点自身")]),t._v(" "),e("td",[t._v("16")])])])]),t._v(" "),e("p",[t._v("身份的认证有4种方式：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("方式")]),t._v(" "),e("th",[t._v("备注")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("world（默认方式）")]),t._v(" "),e("td",[t._v("全世界都能访问")])]),t._v(" "),e("tr",[e("td",[t._v("auth")]),t._v(" "),e("td",[t._v("代表已经认证通过的用户")])]),t._v(" "),e("tr",[e("td",[t._v("digest")]),t._v(" "),e("td",[t._v("用户名密码认证：Base64(sha1(username:password))")])]),t._v(" "),e("tr",[e("td",[t._v("host")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("ip")]),t._v(" "),e("td",[t._v("使用Ip地址认证")])])])]),t._v(" "),e("p",[t._v("授权")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("setAcl /newznode world:anyone:crdwa\n\naddauth /<node-name> digest <username>:<password>\nsetAcl /newznode auth:username:password:crdwa #(同一节点不同用户可多次执行)\n\nsetAcl /<node-name> ip:<IPv4-address>:<permission-set>\t\n")])])]),e("p",[t._v("参考")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("org.apache.zookeeper.server.auth.DigestAuthenticationProvider")])]),t._v(" "),e("li",[e("a",{attrs:{href:"https://zookeeper.apache.org/doc/r3.1.2/zookeeperProgrammers.html#sc_ZooKeeperAccessControl",target:"_blank",rel:"noopener noreferrer"}},[t._v("ZooKeeper access control using ACLs"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=_.exports}}]);