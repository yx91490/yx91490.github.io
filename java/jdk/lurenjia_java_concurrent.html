<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《路人甲java高并发系列》笔记 | yx91490的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.webp">
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QQHZM2VLM0');
window.addEventListener('load', function(){ var s = document.createElement('script'); s.src = "https://www.googletagmanager.com/gtag/js?id=G-QQHZM2VLM0"; document.body.appendChild(s); });</script>
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6781d2ac2dff1f3b278518419b4d4deb";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <meta name="description" content="java, 大数据(hadoop, sqoop, kylin, zeppelin)相关技术, 工作经验记录">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="google-site-verification" content="j1Gm2ZeMV3D7mPiI08fpx91dEOSlhCAJjD4vy_pSroQ">
    <meta name="baidu-site-verification" content="4z2bGbjYMB">
    
    <link rel="preload" href="/assets/css/0.styles.003598ab.css" as="style"><link rel="preload" href="/assets/js/app.a2246195.js" as="script"><link rel="preload" href="/assets/js/2.a92520c9.js" as="script"><link rel="preload" href="/assets/js/144.9117b752.js" as="script"><link rel="prefetch" href="/assets/js/10.9266ea66.js"><link rel="prefetch" href="/assets/js/100.be2d6fa9.js"><link rel="prefetch" href="/assets/js/101.6bf96f53.js"><link rel="prefetch" href="/assets/js/102.b9123862.js"><link rel="prefetch" href="/assets/js/103.3393f6b3.js"><link rel="prefetch" href="/assets/js/104.684c4331.js"><link rel="prefetch" href="/assets/js/105.50f83af8.js"><link rel="prefetch" href="/assets/js/106.af1be028.js"><link rel="prefetch" href="/assets/js/107.03a88e14.js"><link rel="prefetch" href="/assets/js/108.3c9beac7.js"><link rel="prefetch" href="/assets/js/109.1cc12551.js"><link rel="prefetch" href="/assets/js/11.abfb5926.js"><link rel="prefetch" href="/assets/js/110.6496c428.js"><link rel="prefetch" href="/assets/js/111.441b5c62.js"><link rel="prefetch" href="/assets/js/112.c176e7aa.js"><link rel="prefetch" href="/assets/js/113.22b25ffa.js"><link rel="prefetch" href="/assets/js/114.0470f0e2.js"><link rel="prefetch" href="/assets/js/115.133edcde.js"><link rel="prefetch" href="/assets/js/116.5de552b8.js"><link rel="prefetch" href="/assets/js/117.17a14c4a.js"><link rel="prefetch" href="/assets/js/118.c79d4a77.js"><link rel="prefetch" href="/assets/js/119.3a636690.js"><link rel="prefetch" href="/assets/js/12.274720a3.js"><link rel="prefetch" href="/assets/js/120.41a0252a.js"><link rel="prefetch" href="/assets/js/121.18dd56cb.js"><link rel="prefetch" href="/assets/js/122.dcc6fff9.js"><link rel="prefetch" href="/assets/js/123.3e8dd2b0.js"><link rel="prefetch" href="/assets/js/124.c469f9a0.js"><link rel="prefetch" href="/assets/js/125.eb8238e4.js"><link rel="prefetch" href="/assets/js/126.c8b54275.js"><link rel="prefetch" href="/assets/js/127.a9895d7f.js"><link rel="prefetch" href="/assets/js/128.ad16504e.js"><link rel="prefetch" href="/assets/js/129.673ac57e.js"><link rel="prefetch" href="/assets/js/13.473bd291.js"><link rel="prefetch" href="/assets/js/130.9e56a52b.js"><link rel="prefetch" href="/assets/js/131.5423b009.js"><link rel="prefetch" href="/assets/js/132.6438550e.js"><link rel="prefetch" href="/assets/js/133.083d70f2.js"><link rel="prefetch" href="/assets/js/134.80f4d86d.js"><link rel="prefetch" href="/assets/js/135.0368a605.js"><link rel="prefetch" href="/assets/js/136.65c70e71.js"><link rel="prefetch" href="/assets/js/137.676f7436.js"><link rel="prefetch" href="/assets/js/138.d3c68759.js"><link rel="prefetch" href="/assets/js/139.f163f9ac.js"><link rel="prefetch" href="/assets/js/14.4157d143.js"><link rel="prefetch" href="/assets/js/140.0eb4db22.js"><link rel="prefetch" href="/assets/js/141.91c9c472.js"><link rel="prefetch" href="/assets/js/142.ac3a9a62.js"><link rel="prefetch" href="/assets/js/143.156c5dd3.js"><link rel="prefetch" href="/assets/js/145.bf4177dc.js"><link rel="prefetch" href="/assets/js/146.a4e70b4c.js"><link rel="prefetch" href="/assets/js/147.e7503515.js"><link rel="prefetch" href="/assets/js/148.550bb88e.js"><link rel="prefetch" href="/assets/js/149.a3efa6a5.js"><link rel="prefetch" href="/assets/js/15.78885f92.js"><link rel="prefetch" href="/assets/js/150.2b8684be.js"><link rel="prefetch" href="/assets/js/151.723ee132.js"><link rel="prefetch" href="/assets/js/152.2e61447b.js"><link rel="prefetch" href="/assets/js/153.a87224a2.js"><link rel="prefetch" href="/assets/js/154.45b73d0e.js"><link rel="prefetch" href="/assets/js/155.2a158d8e.js"><link rel="prefetch" href="/assets/js/156.6d290334.js"><link rel="prefetch" href="/assets/js/157.dc0ac8e3.js"><link rel="prefetch" href="/assets/js/158.ad8be92a.js"><link rel="prefetch" href="/assets/js/159.17aa0be5.js"><link rel="prefetch" href="/assets/js/16.e9de9925.js"><link rel="prefetch" href="/assets/js/160.f1c672b5.js"><link rel="prefetch" href="/assets/js/161.fced35d3.js"><link rel="prefetch" href="/assets/js/162.14034b66.js"><link rel="prefetch" href="/assets/js/163.b7b22626.js"><link rel="prefetch" href="/assets/js/164.c979848e.js"><link rel="prefetch" href="/assets/js/165.f3b605f4.js"><link rel="prefetch" href="/assets/js/166.31241d54.js"><link rel="prefetch" href="/assets/js/167.99665073.js"><link rel="prefetch" href="/assets/js/168.73a40652.js"><link rel="prefetch" href="/assets/js/169.c6b27f11.js"><link rel="prefetch" href="/assets/js/17.8b238f2d.js"><link rel="prefetch" href="/assets/js/170.9356cc22.js"><link rel="prefetch" href="/assets/js/171.f8f9eeeb.js"><link rel="prefetch" href="/assets/js/172.31967fe5.js"><link rel="prefetch" href="/assets/js/173.6dc70b37.js"><link rel="prefetch" href="/assets/js/174.bad7f12b.js"><link rel="prefetch" href="/assets/js/175.03194976.js"><link rel="prefetch" href="/assets/js/176.5c7853ba.js"><link rel="prefetch" href="/assets/js/177.fc5d3911.js"><link rel="prefetch" href="/assets/js/178.1b8f2927.js"><link rel="prefetch" href="/assets/js/179.7e2010d2.js"><link rel="prefetch" href="/assets/js/18.be942caa.js"><link rel="prefetch" href="/assets/js/180.7fc4904d.js"><link rel="prefetch" href="/assets/js/181.3aa48343.js"><link rel="prefetch" href="/assets/js/182.0da27206.js"><link rel="prefetch" href="/assets/js/183.ea56bc10.js"><link rel="prefetch" href="/assets/js/184.1ba34ef7.js"><link rel="prefetch" href="/assets/js/185.ef514255.js"><link rel="prefetch" href="/assets/js/186.10a22983.js"><link rel="prefetch" href="/assets/js/187.24412415.js"><link rel="prefetch" href="/assets/js/188.9e67f04e.js"><link rel="prefetch" href="/assets/js/189.1a001954.js"><link rel="prefetch" href="/assets/js/19.41661090.js"><link rel="prefetch" href="/assets/js/190.938fd53d.js"><link rel="prefetch" href="/assets/js/191.6036e1aa.js"><link rel="prefetch" href="/assets/js/192.20aaab8b.js"><link rel="prefetch" href="/assets/js/193.1b7ea98e.js"><link rel="prefetch" href="/assets/js/194.1170ccd0.js"><link rel="prefetch" href="/assets/js/195.2da46799.js"><link rel="prefetch" href="/assets/js/196.8c38b115.js"><link rel="prefetch" href="/assets/js/197.c1f360eb.js"><link rel="prefetch" href="/assets/js/198.ab460869.js"><link rel="prefetch" href="/assets/js/199.58b8a906.js"><link rel="prefetch" href="/assets/js/20.7dbafc6d.js"><link rel="prefetch" href="/assets/js/200.a9de3e1c.js"><link rel="prefetch" href="/assets/js/201.9c11ec9b.js"><link rel="prefetch" href="/assets/js/202.31a20041.js"><link rel="prefetch" href="/assets/js/203.561fefc2.js"><link rel="prefetch" href="/assets/js/204.e044c696.js"><link rel="prefetch" href="/assets/js/205.4d437cf2.js"><link rel="prefetch" href="/assets/js/206.074913eb.js"><link rel="prefetch" href="/assets/js/207.f582a2d4.js"><link rel="prefetch" href="/assets/js/208.34c09bd0.js"><link rel="prefetch" href="/assets/js/21.4e3c7f50.js"><link rel="prefetch" href="/assets/js/22.cda475a6.js"><link rel="prefetch" href="/assets/js/23.6677c452.js"><link rel="prefetch" href="/assets/js/24.2e483650.js"><link rel="prefetch" href="/assets/js/25.32b8e5f5.js"><link rel="prefetch" href="/assets/js/26.c63edd69.js"><link rel="prefetch" href="/assets/js/27.6462a4d2.js"><link rel="prefetch" href="/assets/js/28.39745e0d.js"><link rel="prefetch" href="/assets/js/29.3ce79aa0.js"><link rel="prefetch" href="/assets/js/3.cd488c94.js"><link rel="prefetch" href="/assets/js/30.c3c07fa8.js"><link rel="prefetch" href="/assets/js/31.b441fe2c.js"><link rel="prefetch" href="/assets/js/32.9d627aa9.js"><link rel="prefetch" href="/assets/js/33.0a131b8b.js"><link rel="prefetch" href="/assets/js/34.e589c02b.js"><link rel="prefetch" href="/assets/js/35.b905220f.js"><link rel="prefetch" href="/assets/js/36.1451544a.js"><link rel="prefetch" href="/assets/js/37.8e64b501.js"><link rel="prefetch" href="/assets/js/38.ac5585b7.js"><link rel="prefetch" href="/assets/js/39.b7d08e4d.js"><link rel="prefetch" href="/assets/js/4.76c12804.js"><link rel="prefetch" href="/assets/js/40.1e627739.js"><link rel="prefetch" href="/assets/js/41.296baa8a.js"><link rel="prefetch" href="/assets/js/42.e762bf53.js"><link rel="prefetch" href="/assets/js/43.0c8916ee.js"><link rel="prefetch" href="/assets/js/44.fb27d611.js"><link rel="prefetch" href="/assets/js/45.a5c6e285.js"><link rel="prefetch" href="/assets/js/46.c00ec7b1.js"><link rel="prefetch" href="/assets/js/47.924f6a63.js"><link rel="prefetch" href="/assets/js/48.da552f4a.js"><link rel="prefetch" href="/assets/js/49.d4b2e85f.js"><link rel="prefetch" href="/assets/js/5.43a1b6a5.js"><link rel="prefetch" href="/assets/js/50.b0cbb861.js"><link rel="prefetch" href="/assets/js/51.d53173dc.js"><link rel="prefetch" href="/assets/js/52.cec22911.js"><link rel="prefetch" href="/assets/js/53.856b0cbd.js"><link rel="prefetch" href="/assets/js/54.a949b4ab.js"><link rel="prefetch" href="/assets/js/55.8b1c4821.js"><link rel="prefetch" href="/assets/js/56.075464d0.js"><link rel="prefetch" href="/assets/js/57.edeffd0c.js"><link rel="prefetch" href="/assets/js/58.f17ca774.js"><link rel="prefetch" href="/assets/js/59.83a509b9.js"><link rel="prefetch" href="/assets/js/6.8c8eb26f.js"><link rel="prefetch" href="/assets/js/60.b2ac681b.js"><link rel="prefetch" href="/assets/js/61.06292aef.js"><link rel="prefetch" href="/assets/js/62.efb1d9ca.js"><link rel="prefetch" href="/assets/js/63.c621ff20.js"><link rel="prefetch" href="/assets/js/64.fd7d869b.js"><link rel="prefetch" href="/assets/js/65.d6e18805.js"><link rel="prefetch" href="/assets/js/66.8e4764ed.js"><link rel="prefetch" href="/assets/js/67.39c5f354.js"><link rel="prefetch" href="/assets/js/68.01631967.js"><link rel="prefetch" href="/assets/js/69.21c55f66.js"><link rel="prefetch" href="/assets/js/7.811e798c.js"><link rel="prefetch" href="/assets/js/70.d93f9ac4.js"><link rel="prefetch" href="/assets/js/71.edff7b32.js"><link rel="prefetch" href="/assets/js/72.58f44a0d.js"><link rel="prefetch" href="/assets/js/73.945f295a.js"><link rel="prefetch" href="/assets/js/74.8ca95c7a.js"><link rel="prefetch" href="/assets/js/75.2bda719a.js"><link rel="prefetch" href="/assets/js/76.160188c6.js"><link rel="prefetch" href="/assets/js/77.13d44a5c.js"><link rel="prefetch" href="/assets/js/78.bc9b4703.js"><link rel="prefetch" href="/assets/js/79.51f0cbe9.js"><link rel="prefetch" href="/assets/js/8.b01cfa02.js"><link rel="prefetch" href="/assets/js/80.d5ee7d7e.js"><link rel="prefetch" href="/assets/js/81.a8cb1bb1.js"><link rel="prefetch" href="/assets/js/82.f2466831.js"><link rel="prefetch" href="/assets/js/83.42e24b89.js"><link rel="prefetch" href="/assets/js/84.f11efdd6.js"><link rel="prefetch" href="/assets/js/85.dfb94ac5.js"><link rel="prefetch" href="/assets/js/86.b722d02e.js"><link rel="prefetch" href="/assets/js/87.50dfa4f1.js"><link rel="prefetch" href="/assets/js/88.1f1be810.js"><link rel="prefetch" href="/assets/js/89.9c872859.js"><link rel="prefetch" href="/assets/js/9.6643bf27.js"><link rel="prefetch" href="/assets/js/90.b45fd9d8.js"><link rel="prefetch" href="/assets/js/91.abf3f5f6.js"><link rel="prefetch" href="/assets/js/92.c4da0439.js"><link rel="prefetch" href="/assets/js/93.ee4705d1.js"><link rel="prefetch" href="/assets/js/94.b5887f79.js"><link rel="prefetch" href="/assets/js/95.1950dbcb.js"><link rel="prefetch" href="/assets/js/96.7fbdc57f.js"><link rel="prefetch" href="/assets/js/97.4e371474.js"><link rel="prefetch" href="/assets/js/98.acbe433f.js"><link rel="prefetch" href="/assets/js/99.358cb13a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.003598ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">yx91490的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java/" class="nav-link router-link-active">
  Java开发
</a></div><div class="nav-item"><a href="/bigdata/" class="nav-link">
  大数据
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="contactMe" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="contactMe" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/clang/" class="nav-link">
  C语言
</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/diagram/" class="nav-link">
  图示速查
</a></li><li class="dropdown-item"><!----> <a href="/collection/" class="nav-link">
  资料收藏
</a></li><li class="dropdown-item"><!----> <a href="/cs/" class="nav-link">
  计算机科学
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/yx91490" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/yx91490/yx91490.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  给我留言
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/java/" class="nav-link router-link-active">
  Java开发
</a></div><div class="nav-item"><a href="/bigdata/" class="nav-link">
  大数据
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="contactMe" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="contactMe" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/clang/" class="nav-link">
  C语言
</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/diagram/" class="nav-link">
  图示速查
</a></li><li class="dropdown-item"><!----> <a href="/collection/" class="nav-link">
  资料收藏
</a></li><li class="dropdown-item"><!----> <a href="/cs/" class="nav-link">
  计算机科学
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/yx91490" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/yx91490/yx91490.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  给我留言
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Maven</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/maven/maven.html" class="sidebar-link">Maven指南</a></li><li><a href="/java/maven/maven_principle.html" class="sidebar-link">Maven原理</a></li><li><a href="/java/maven/maven_archetype.html" class="sidebar-link">Maven原型模板介绍</a></li><li><a href="/java/maven/maven_plugin.html" class="sidebar-link">Maven常用插件配置</a></li><li><a href="/java/maven/maven_modules.html" class="sidebar-link">优雅地修改多模块项目中的版本号</a></li><li><a href="/java/maven/maven_assembly_spi.html" class="sidebar-link">Maven assembly插件与Java SPI机制冲突问题</a></li><li><a href="/java/maven/maven_release_jar.html" class="sidebar-link">发布Jar包到Maven中央仓库指南</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java环境</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/java-env/jdk_tools.html" class="sidebar-link">JDK命令工具</a></li><li><a href="/java/java-env/class_path.html" class="sidebar-link">类路径ClassPath</a></li><li><a href="/java/java-env/mat_cmd_tool.html" class="sidebar-link">命令行分析HeapDump文件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JDK</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/jdk/java.html" class="sidebar-link">Java学习笔记</a></li><li><a href="/java/jdk/ieee754.html" class="sidebar-link">IEEE二进制浮点数算术标准</a></li><li><a href="/java/jdk/enum.html" class="sidebar-link">Enum枚举</a></li><li><a href="/java/jdk/urlencode.html" class="sidebar-link">URL编码笔记</a></li><li><a href="/java/jdk/jdbc.html" class="sidebar-link">JDBC笔记</a></li><li><a href="/java/jdk/red_black_tree.html" class="sidebar-link">红黑树</a></li><li><a href="/java/jdk/hashmap.html" class="sidebar-link">JDK1.7 HashMap实现原理</a></li><li><a href="/java/jdk/concurrent-hashmap.html" class="sidebar-link">ConcurrentHashMap原理</a></li><li><a href="/java/jdk/date_time.html" class="sidebar-link">日期和时间标准</a></li><li><a href="/java/jdk/joda_time_period.html" class="sidebar-link">Joda-Time时间段（译文）</a></li><li><a href="/java/jdk/joda_time_interval.html" class="sidebar-link">Joda-Time时间间隔（译文）</a></li><li><a href="/java/jdk/joda_time_quickstart.html" class="sidebar-link">Joda－Time快速上手指导（译文）</a></li><li><a href="/java/jdk/jdk_new_features.html" class="sidebar-link">JDK各版本新特性</a></li><li><a href="/java/jdk/not_catch_throw_error.html" class="sidebar-link">throw Error没有捕获的问题排查</a></li><li><a href="/java/jdk/no_such_method_error.html" class="sidebar-link">NoSuchMethodError问题的通用调试方法</a></li><li><a href="/java/jdk/io.html" class="sidebar-link">Java IO模型</a></li><li><a href="/java/jdk/multi_thread.html" class="sidebar-link">多线程笔记</a></li><li><a href="/java/jdk/thread_pool.html" class="sidebar-link">Java线程池</a></li><li><a href="/java/jdk/aqs.html" class="sidebar-link">AbstractQueuedSynchronizer笔记</a></li><li><a href="/java/jdk/condition.html" class="sidebar-link">Condition笔记</a></li><li><a href="/java/jdk/java_concurrent_framework.html" class="sidebar-link">Java并发集合框架</a></li><li><a href="/java/jdk/lurenjia_java_concurrent.html" aria-current="page" class="active sidebar-link">《路人甲java高并发系列》笔记</a></li><li><a href="/java/jdk/unicode.html" class="sidebar-link">Unicode学习笔记</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/jvm/arthas.html" class="sidebar-link">Arthas学习笔记</a></li><li><a href="/java/jvm/jvm_parameter.html" class="sidebar-link">JVM参数</a></li><li><a href="/java/jvm/classloader.html" class="sidebar-link">类与类加载器</a></li><li><a href="/java/jvm/java_memory_model.html" class="sidebar-link">Java内存模型</a></li><li><a href="/java/jvm/java_runtime_data_region.html" class="sidebar-link">java运行时数据区</a></li><li><a href="/java/jvm/gc.html" class="sidebar-link">GC算法与垃圾收集器笔记</a></li><li><a href="/java/jvm/cms_parnew_gc_log_format.html" class="sidebar-link">CMS GC日志格式</a></li><li><a href="/java/jvm/young_gc_stw.html" class="sidebar-link">Yong GC会导致stop-the-world</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>常用库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/library/slf4j.html" class="sidebar-link">日志框架</a></li><li><a href="/java/library/slf4j_nop.html" class="sidebar-link">slf4jNOP问题</a></li><li><a href="/java/library/javamail.html" class="sidebar-link">JavaMail使用总结</a></li><li><a href="/java/library/httpclient_fluent_trap.html" class="sidebar-link">HttpClient FluentAPI使用小坑</a></li><li><a href="/java/library/poi_full_gc.html" class="sidebar-link">POI导出Excel文件FullGC的解决办法</a></li><li><a href="/java/library/ctrl_char_in_json.html" class="sidebar-link">JSON中的控制字符无法解析的问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Spring框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/spring/spring_url_pattern.html" class="sidebar-link">一个Spring URL匹配问题</a></li><li><a href="/java/spring/proguard.html" class="sidebar-link">Spring Boot项目代码混淆指南</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>缓存</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/redis/redis.html" class="sidebar-link">Redis数据结构</a></li><li><a href="/java/redis/cache.html" class="sidebar-link">缓存的使用模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/architecture/design_pattern.html" class="sidebar-link">设计模式笔记</a></li><li><a href="/java/architecture/redis_distributelock.html" class="sidebar-link">Redis实现分布式锁</a></li><li><a href="/java/architecture/short_url_design.html" class="sidebar-link">如何设计一个短链接服务</a></li><li><a href="/java/architecture/three_layer.html" class="sidebar-link">互联网公司三层架构总结</a></li><li><a href="/java/architecture/year_based_week.html" class="sidebar-link">数据分析中的年中周数界定</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Tomcat</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/tomcat/tomcat_host.html" class="sidebar-link">一个Tomcat host配置错误导致的问题</a></li><li><a href="/java/tomcat/tomcat_400.html" class="sidebar-link">一个访问路径包含转义&quot;/&quot;导致Tomcat 400的问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/tools/macos.html" class="sidebar-link">MacOS开发环境最佳实践</a></li><li><a href="/java/tools/idea.html" class="sidebar-link">Idea配置总结</a></li><li><a href="/java/tools/git.html" class="sidebar-link">Git笔记</a></li><li><a href="/java/tools/svn.html" class="sidebar-link">SVN笔记</a></li><li><a href="/java/tools/editor.html" class="sidebar-link">常用编辑器</a></li><li><a href="/java/tools/vim.html" class="sidebar-link">Vim的那些事</a></li><li><a href="/java/tools/typora.html" class="sidebar-link">Typora:最好用的Markdown编辑器</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="《路人甲java高并发系列》笔记"><a href="#《路人甲java高并发系列》笔记" class="header-anchor">$</a> 《路人甲java高并发系列》笔记</h1> <h2 id="第6天-线程的基本操作"><a href="#第6天-线程的基本操作" class="header-anchor">$</a> 第6天:线程的基本操作</h2> <h3 id="新建线程"><a href="#新建线程" class="header-anchor">$</a> 新建线程</h3> <p><strong>调用start方法和直接调用run方法的区别？</strong></p> <p>start方法是启动一个线程，run方法只会在当前线程中串行的执行run方法中的代码。<strong>因此推荐通过实现Runnable接口定义线程。</strong></p> <h3 id="终止线程"><a href="#终止线程" class="header-anchor">$</a> 终止线程</h3> <p><code>Thread.stop()</code>会强制把正在执行的线程停止了，不推荐使用。</p> <h3 id="线程中断"><a href="#线程中断" class="header-anchor">$</a> 线程中断</h3> <p><strong>Thread提供了3个与线程中断有关的方法：</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//中断线程</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//判断线程是否被中断</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//判断线程是否被中断，并清除当前中断状态</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>通过变量控制和线程自带的interrupt方法来中断线程有什么区别呢？</strong></p> <p>如果一个线程调用了sleep方法，一直处于休眠状态，通过变量控制，不能中断线程，此时只能使用线程提供的interrupt()方法来中断线程了。</p> <p>调用interrupt()方法之后，线程的sleep方法将会抛出<code>InterruptedException</code>异常。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//休眠100秒</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//sleep方法由于中断而抛出异常之后，线程的中断标志会被清除（置为false）</span>
                <span class="token comment">// 所以在异常中需要执行this.interrupt()方法，将中断标志位置为true</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我要退出了!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="等待和通知"><a href="#等待和通知" class="header-anchor">$</a> 等待和通知</h3> <p><strong>为了支持多线程之间的协作，JDK提供了两个非常重要的方法：等待wait()方法和通知notify()方法。</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token keyword">int</span> nanos<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意：被等待的线程执行完毕之后，系统自动会调用该线程的notifyAll()方法。所以一般情况下，我们不要去在线程对象上使用wait()、notify()、notifyAll()方法。</p> <p><strong>Object.wait()方法和Thread.sleep()方法的区别？</strong></p> <p>都可以让现场等待若干时间。除wait()方法可以被唤醒外，另外一个主要的区别就是wait()方法会释放目标对象的锁，而Thread.sleep()方法不会释放锁。</p> <h3 id="挂起和继续执行"><a href="#挂起和继续执行" class="header-anchor">$</a> 挂起和继续执行</h3> <p><strong>Thread类中还有2个方法，即线程挂起(<s>suspend</s>)和继续执行(<s>resume</s>)，不推荐使用的原因？</strong></p> <p>系统不推荐使用~~suspend()<s>方法去挂起线程是因为</s>suspend()~~方法导致线程暂停的同时，并不会释放任何锁资源。而且，对于被挂起的线程，从它线程的状态上看，居然还是<code>Runnable</code>状态，这也会影响我们对系统当前状态的判断。</p> <h3 id="等待线程结束和谦让"><a href="#等待线程结束和谦让" class="header-anchor">$</a> 等待线程结束和谦让</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token comment">/**
* 等待此线程结束最多 millis 毫秒. 超时时间为 0 意味着永久等待。
* 在 {this.isAlive} 条件下循环调用 {this.wait}来实现. 当线程结束
* {this.notifyAll} 方法会被调用. 建议应用程序不要调用Thread实例的 {wait}, {notify}, {notifyAll}
*
* @param  millis 需要等待的毫秒时间
* @throws IllegalArgumentException 如果参数 {millis} 是负数
* @throws InterruptedException  如果任何线程中断了当前线程. 异常抛出后
*/</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>Thread.yield()</code>会让当前线程出让CPU，当前线程在出让CPU后，还会进行CPU资源的争夺，但是能否再抢到CPU的执行权就不一定了。如果觉得一个线程不太重要，或者优先级比较低，而又担心此线程会过多的占用CPU资源，那么可以在适当的时候调用一下Thread.yield()方法，给与其他线程更多的机会。</p> <h2 id="第8天-线程组"><a href="#第8天-线程组" class="header-anchor">$</a> 第8天:线程组</h2> <p>我们可以把线程归属到某个线程组中，线程组可以包含多个线程以及线程组，线程和线程组组成了父子关系，是个树形结构。</p> <h3 id="为线程组指定父线程组"><a href="#为线程组指定父线程组" class="header-anchor">$</a> 为线程组指定父线程组</h3> <p>threadGroup1未指定父线程组，系统获取了主线程的线程组作为threadGroup1的父线程组，输出结果中是：main
threadGroup1为threadGroup2的父线程组
threadGroup1活动线程数为4，包含了threadGroup1线程组中的t1、t2，以及子线程组threadGroup2中的t3、t4
线程组的list()方法，将线程组中的所有子孙节点信息输出到控制台，用于调试使用</p> <h3 id="根线程组"><a href="#根线程组" class="header-anchor">$</a> 根线程组</h3> <p>主线程的线程组为main
根线程组为system</p> <h3 id="批量停止线程"><a href="#批量停止线程" class="header-anchor">$</a> 批量停止线程</h3> <p>调用线程组interrupt()，会将线程组树下的所有子孙线程中断标志置为true，可以用来批量中断线程。</p> <h2 id="第9天-用户线程和守护线程"><a href="#第9天-用户线程和守护线程" class="header-anchor">$</a> 第9天:用户线程和守护线程</h2> <ol><li>java中的线程分为用户线程和守护线程</li> <li>程序中的所有的用户线程结束之后，不管守护线程处于什么状态，java虚拟机都会自动退出</li> <li>调用线程的实例方法setDaemon()来设置线程是否是守护线程</li> <li>setDaemon()方法必须在线程的start()方法之前调用，在后面调用会报异常，并且不起效</li> <li>线程的daemon默认值和其父线程一样</li></ol> <h2 id="第10天-线程安全和synchronized关键字"><a href="#第10天-线程安全和synchronized关键字" class="header-anchor">$</a> 第10天:线程安全和synchronized关键字</h2> <h3 id="什么是线程安全"><a href="#什么是线程安全" class="header-anchor">$</a> 什么是线程安全？</h3> <p>造成线程安全问题的主要诱因有两点：</p> <ol><li>一是存在共享数据(也称临界资源)</li> <li>二是存在多条线程共同操作共享数据</li></ol> <p><strong>需要保证同一时刻有且只有一个线程在操作共享数据</strong>，其他线程必须等到该线程处理完数据后再进行，这种方式有个高尚的名称叫<strong>互斥锁</strong></p> <p><strong>关键字 synchronized可以保证在同一个时刻，只有一个线程可以执行某个方法或者某个代码块(主要是对方法或者代码块中存在共享数据的操作)</strong>，<strong>同时我们还应该注意到synchronized另外一个重要的作用，synchronized可保证一个线程的变化(主要是共享数据的变化)被其他线程所看到（保证可见性，完全可以替代volatile功能）</strong></p> <p>synchronized主要有3种使用方式：</p> <ol><li>修饰实例方法，作用于当前实例，进入同步代码前需要先获取实例的锁</li> <li>修饰静态方法，作用于类的Class对象，进入修饰的静态方法前需要先获取类的Class对象的锁</li> <li>修饰代码块，需要指定加锁对象(记做lockobj)，在进入同步代码块前需要先获取lockobj的锁</li></ol> <h3 id="synchronized可以确保变量的可见性"><a href="#synchronized可以确保变量的可见性" class="header-anchor">$</a> synchronized可以确保变量的可见性</h3> <h2 id="第11天-线程中断的几种方式"><a href="#第11天-线程中断的几种方式" class="header-anchor">$</a> 第11天:线程中断的几种方式</h2> <ul><li>通过一个变量控制线程中断</li> <li>通过线程自带的中断标志控制</li> <li>线程阻塞状态中的中断</li></ul> <h2 id="第12天juc-reentrantlock重入锁"><a href="#第12天juc-reentrantlock重入锁" class="header-anchor">$</a> 第12天JUC:ReentrantLock重入锁</h2> <ol><li>可重入锁：可重入锁是指同一个线程可以多次获得同一把锁；ReentrantLock和关键字Synchronized都是可重入锁</li> <li>可中断锁：可中断锁时只线程在获取锁的过程中，是否可以相应线程中断操作。synchronized是不可中断的，ReentrantLock是可中断的</li> <li>公平锁和非公平锁：公平锁是指多个线程尝试获取同一把锁的时候，获取锁的顺序按照线程到达的先后顺序获取，而不是随机插队的方式获取。synchronized是非公平锁，而ReentrantLock是两种都可以实现，不过默认是非公平锁</li></ol> <p>ReentrantLock的使用过程：</p> <ol><li>创建锁：ReentrantLock lock = new ReentrantLock();</li> <li>获取锁：lock.lock()</li> <li>释放锁：lock.unlock();</li></ol> <p>上面代码需要注意lock.unlock()一定要放在finally中，否则，若程序出现了异常，锁没有释放，那么其他线程就再也没有机会获取这个锁了。</p> <p>关于lock()有几点需要注意：</p> <ol><li>lock()方法和unlock()方法需要成对出现，锁了几次，也要释放几次，否则后面的线程无法获取锁了；可以将add中的unlock删除一个试试，上面代码运行将无法结束</li> <li>unlock()方法放在finally中执行，保证不管程序是否有异常，锁必定会释放</li></ol> <p>关于lockInterruptibly()注意几点:</p> <ol><li>ReentrankLock中必须使用实例方法lockInterruptibly()获取锁时，在线程调用interrupt()方法之后，才会引发InterruptedException异常</li> <li>线程调用interrupt()之后，线程的中断标志会被置为true</li> <li>触发InterruptedException异常之后，线程的中断标志有会被清空，即置为false</li> <li>所以当线程调用interrupt()引发InterruptedException异常，中断标志的变化是:false-&gt;true-&gt;false</li></ol> <p>关于tryLock()方法和tryLock(long timeout, TimeUnit unit)方法，说明一下：</p> <ol><li><p>都会返回boolean值，结果表示获取锁是否成功</p></li> <li><p>tryLock()方法，不管是否获取成功，都会立即返回；</p> <p>而有参的tryLock方法会尝试在指定的时间内去获取锁，中间会阻塞的现象，在指定的时间之后会不管是否能够获取锁都会返回结果</p></li> <li><p>tryLock()方法不会响应线程的中断方法；而有参的tryLock方法会响应线程的中断方法，而出发<code>InterruptedException</code>异常，这个从2个方法的声明上可以可以看出来</p></li></ol> <h2 id="获取锁的4中方法对比"><a href="#获取锁的4中方法对比" class="header-anchor">$</a> 获取锁的4中方法对比</h2> <table><thead><tr><th>获取锁的方法</th> <th>是否立即响应(不会阻塞)</th> <th>是否响应中断</th></tr></thead> <tbody><tr><td>lock()</td> <td>×</td> <td>×</td></tr> <tr><td>tryLock()</td> <td>√</td> <td>×</td></tr> <tr><td>tryLock(long timeout, TimeUnit unit)</td> <td>×</td> <td>√</td></tr> <tr><td>lockInterruptibly()</td> <td>×</td> <td>√</td></tr></tbody></table> <h2 id="第13天-juc中的condition对象"><a href="#第13天-juc中的condition对象" class="header-anchor">$</a> 第13天:JUC中的Condition对象</h2> <p>从整体上来看<strong>Object的wait和notify/notify是与对象监视器配合完成线程间的等待/通知机制，而Condition与Lock配合完成等待通知机制，前者是java底层级别的，后者是语言级别的，具有更高的可控制性和扩展性</strong>。两者除了在使用方式上不同外，在<strong>功能特性</strong>上还是有很多的不同：</p> <ol><li>Condition能够支持不响应中断，而通过使用Object方式不支持</li> <li>Condition能够支持多个等待队列（new 多个Condition对象），而Object方式只能支持一个</li> <li>Condition能够支持超时时间的设置，而Object不支持</li></ol> <p>Condition由ReentrantLock对象创建，并且可以同时创建多个，Condition接口在使用前必须先调用ReentrantLock的lock()方法获得锁，之后调用Condition接口的await()将释放锁，并且在该Condition上等待，直到有其他线程调用Condition的signal()方法唤醒线程，使用方式和wait()、notify()类似。</p> <p>Condition接口提供的常用方法有：</p> <ol><li>void await() throws InterruptedException:当前线程进入等待状态，如果其他线程调用condition的signal或者signalAll方法并且当前线程获取Lock从await方法返回，如果在等待状态中被中断会抛出被中断异常；</li> <li>long awaitNanos(long nanosTimeout)：当前线程进入等待状态直到被通知，中断或者<strong>超时</strong>；</li> <li>boolean await(long time, TimeUnit unit) throws InterruptedException：同第二种，支持自定义时间单位，false：表示方法超时之后自动返回的，true：表示等待还未超时时，await方法就返回了（超时之前，被其他线程唤醒了）</li> <li>boolean awaitUntil(Date deadline) throws InterruptedException：当前线程进入等待状态直到被通知，中断或者<strong>到了某个时间</strong></li> <li>void awaitUninterruptibly();：当前线程进入等待状态，不会响应线程中断操作，只能通过唤醒的方式让线程继续</li> <li>void signal()：唤醒一个等待在condition上的线程，将该线程从<strong>等待队列</strong>中转移到<strong>同步队列</strong>中，如果在同步队列中能够竞争到Lock则可以从等待方法中返回。</li> <li>void signalAll()：与1的区别在于能够唤醒所有等待在condition上的线程</li></ol> <h3 id="object的监视器方法与condition接口的对比"><a href="#object的监视器方法与condition接口的对比" class="header-anchor">$</a> Object的监视器方法与Condition接口的对比</h3> <table><thead><tr><th>对比项</th> <th>Object 监视器方法</th> <th>Condition</th></tr></thead> <tbody><tr><td>前置条件</td> <td>获取对象的锁</td> <td>调用Lock.lock获取锁，调用Lock.newCondition()获取Condition对象</td></tr> <tr><td>调用方式</td> <td>直接调用，如：object.wait()</td> <td>直接调用，如：condition.await()</td></tr> <tr><td>等待队列个数</td> <td>一个</td> <td>多个，使用多个condition实现</td></tr> <tr><td>当前线程释放锁并进入等待状态</td> <td>支持</td> <td>支持</td></tr> <tr><td>当前线程释放锁进入等待状态中不响应中断</td> <td>不支持</td> <td>支持</td></tr> <tr><td>当前线程释放锁并进入超时等待状态</td> <td>支持</td> <td>支持</td></tr> <tr><td>当前线程释放锁并进入等待状态到将来某个时间</td> <td>不支持</td> <td>支持</td></tr> <tr><td>唤醒等待队列中的一个线程</td> <td>支持</td> <td>支持</td></tr> <tr><td>唤醒等待队列中的全部线程</td> <td>支持</td> <td>支持</td></tr></tbody></table> <h3 id="总结"><a href="#总结" class="header-anchor">$</a> 总结</h3> <ol><li>使用condition的步骤：创建condition对象，获取锁，然后调用condition的方法</li> <li>一个ReentrantLock支持床多个condition对象</li> <li><code>void await() throws InterruptedException;</code>方法会释放锁，让当前线程等待，支持唤醒，支持线程中断</li> <li><code>void awaitUninterruptibly();</code>方法会释放锁，让当前线程等待，支持唤醒，不支持线程中断</li> <li><code>long awaitNanos(long nanosTimeout) throws InterruptedException;</code>参数为纳秒，此方法会释放锁，让当前线程等待，支持唤醒，支持中断。超时之后返回的，结果为负数；超时之前返回的，结果为正数（表示返回时距离超时时间相差的纳秒数）</li> <li><code>boolean await(long time, TimeUnit unit) throws InterruptedException;</code>方法会释放锁，让当前线程等待，支持唤醒，支持中断。超时之后返回的，结果为false；超时之前返回的，结果为true</li> <li><code>boolean awaitUntil(Date deadline) throws InterruptedException;</code>参数表示超时的截止时间点，方法会释放锁，让当前线程等待，支持唤醒，支持中断。超时之后返回的，结果为false；超时之前返回的，结果为true</li> <li><code>void signal();</code>会唤醒一个等待中的线程，然后被唤醒的线程会被加入同步队列，去尝试获取锁</li> <li><code>void signalAll();</code>会唤醒所有等待中的线程，将所有等待中的线程加入同步队列，然后去尝试获取锁</li></ol> <h2 id="第14天-juc中的locksupport工具类-必备技能"><a href="#第14天-juc中的locksupport工具类-必备技能" class="header-anchor">$</a> 第14天：JUC中的LockSupport工具类，必备技能</h2> <p><strong>Object和Condition的局限性：</strong></p> <p>关于Object和Condtion中线程等待和唤醒的局限性，有以下几点：</p> <ol><li>2中方式中的让线程等待和唤醒的方法能够执行的先决条件是：线程需要先获取锁</li> <li>唤醒方法需要在等待方法之后调用，线程才能够被唤醒</li></ol> <p>关于这2点，LockSupport都不需要，就能实现线程的等待和唤醒。下面我们来说一下LockSupport类。</p> <p><strong>LockSupport类可以阻塞当前线程以及唤醒指定被阻塞的线程。主要是通过park()和unpark(thread)方法来实现阻塞和唤醒线程的操作的：</strong></p> <ol><li>每个线程都有一个许可(permit)，<strong>permit只有两个值1和0</strong>，默认是0。</li> <li>当调用unpark(thread)方法，就会将thread线程的许可permit设置成1(<strong>注意多次调用unpark方法，不会累加，permit值还是1</strong>)。</li> <li>当调用park()方法，如果当前线程的permit是1，那么将permit设置为0，并立即返回。如果当前线程的permit是0，那么当前线程就会阻塞，直到别的线程将当前线程的permit设置为1时，park方法会被唤醒，然后会将permit再次设置为0，并返回。</li></ol> <blockquote><p>注意：因为permit默认是0，所以一开始调用park()方法，线程必定会被阻塞。调用unpark(thread)方法后，会自动唤醒thread线程，即park方法立即返回。</p></blockquote> <p><strong>LockSupport.park方法让线程等待之后，唤醒方式有2种：</strong></p> <ol><li>调用LockSupport.unpark方法</li> <li>调用等待线程的<code>interrupt()</code>方法，给等待的线程发送中断信号，可以唤醒线程</li></ol> <p>线程等待和唤醒的3种方式做个对比：</p> <p><strong>到目前为止，已经说了3种让线程等待和唤醒的方法了：</strong></p> <ol><li>方式1：Object中的wait、notify、notifyAll方法</li> <li>方式2：juc中Condition接口提供的await、signal、signalAll方法</li> <li>方式3：juc中的LockSupport提供的park、unpark方法</li></ol> <table><thead><tr><th></th> <th>Object</th> <th>Condtion</th> <th>LockSupport</th></tr></thead> <tbody><tr><td>前置条件</td> <td>需要在synchronized中运行</td> <td>需要先获取Lock的锁</td> <td>无</td></tr> <tr><td>无限等待</td> <td>支持</td> <td>支持</td> <td>支持</td></tr> <tr><td>超时等待</td> <td>支持</td> <td>支持</td> <td>支持</td></tr> <tr><td>等待到将来某个时间返回</td> <td>不支持</td> <td>支持</td> <td>支持</td></tr> <tr><td>等待状态中释放锁</td> <td>会释放</td> <td>会释放</td> <td>不会释放</td></tr> <tr><td>唤醒方法先于等待方法执行，能否唤醒线程</td> <td>否</td> <td>否</td> <td>可以</td></tr> <tr><td>是否能响应线程中断</td> <td>是</td> <td>是</td> <td>是</td></tr> <tr><td>线程中断是否会清除中断标志</td> <td>是</td> <td>是</td> <td>否</td></tr> <tr><td>是否支持等待状态中不响应中断</td> <td>不支持</td> <td>支持</td> <td>不支持</td></tr></tbody></table> <h2 id="第15天-juc中的semaphore-最简单的限流工具类-必备技能"><a href="#第15天-juc中的semaphore-最简单的限流工具类-必备技能" class="header-anchor">$</a> 第15天：JUC中的Semaphore，最简单的限流工具类，必备技能</h2> <p>信号量可以控制有多少个线程可以同时访问特定的资源。</p> <p>Semaphore主要方法：</p> <ul><li><strong>Semaphore(int permits)</strong>：构造方法，参数表示许可证数量，用来创建信号量</li> <li><strong>Semaphore(int permits,boolean fair)</strong>：构造方法，当fair等于true时，创建具有给定许可数的计数信号量并设置为公平信号量</li> <li><strong>void acquire() throws InterruptedException</strong>：从此信号量获取1个许可前线程将一直阻塞，相当于一辆车占了一个车位，此方法会响应线程中断，表示调用线程的interrupt方法，会使该方法抛出InterruptedException异常</li> <li><strong>void acquire(int permits) throws InterruptedException</strong> ：和acquire()方法类似，参数表示需要获取许可的数量；比如一个大卡车要入停车场，由于车比较大，需要申请3个车位才可以停放</li> <li><strong>void acquireUninterruptibly(int permits)</strong> ：和acquire(int permits) 方法类似，只是不会响应线程中断</li> <li><strong>boolean tryAcquire()</strong>：尝试获取1个许可，不管是否能够获取成功，都立即返回，true表示获取成功，false表示获取失败</li> <li><strong>boolean tryAcquire(int permits)</strong>：和tryAcquire()，表示尝试获取permits个许可</li> <li><strong>boolean tryAcquire(long timeout, TimeUnit unit) throws InterruptedException</strong>：尝试在指定的时间内获取1个许可，获取成功返回true，指定的时间过后还是无法获取许可，返回false</li> <li><strong>boolean tryAcquire(int permits, long timeout, TimeUnit unit) throws InterruptedException</strong>：和tryAcquire(long timeout, TimeUnit unit)类似，多了一个permits参数，表示尝试获取permits个许可</li> <li><strong>void release()</strong>：释放一个许可，将其返回给信号量，相当于车从停车场出去时将钥匙归还给门卫</li> <li><strong>void release(int n)</strong>：释放n个许可</li> <li><strong>int availablePermits()</strong>：当前可用的许可数</li></ul> <p>其他一些使用说明：</p> <ol><li>Semaphore默认创建的是非公平的信号量。</li> <li>获取信号量成功后才需要释放。</li> <li>方法中带有<code>throws InterruptedException</code>声明的，表示这个方法会响应线程中断信号，什么意思？表示调用线程的<code>interrupt()</code>方法，会让这些方法触发<code>InterruptedException</code>异常，即使这些方法处于阻塞状态，也会立即返回，并抛出<code>InterruptedException</code>异常，线程中断信号也会被清除。</li></ol> <h2 id="第16天-juc中等待多线程完成的工具类countdownlatch-必备技能"><a href="#第16天-juc中等待多线程完成的工具类countdownlatch-必备技能" class="header-anchor">$</a> 第16天：JUC中等待多线程完成的工具类CountDownLatch，必备技能</h2> <p>可以看一下join的源码，内部其实是在synchronized方法中调用了线程的wait方法，最后被调用的线程执行完毕之后，由jvm自动调用其notifyAll()方法，唤醒所有等待中的线程。这个notifyAll()方法是由jvm内部自动调用的，jdk源码中是看不到的，需要看jvm源码，有兴趣的同学可以去查一下。所以JDK不推荐在线程上调用wait、notify、notifyAll方法。</p> <p>而在JDK1.5之后的并发包中提供的CountDownLatch也可以实现join的这个功能。</p> <p><strong>CountDownLatch使用步骤：</strong></p> <ol><li>创建CountDownLatch对象</li> <li>调用其实例方法<code>await()</code>，让当前线程等待</li> <li>调用<code>countDown()</code>方法，让计数器减1</li> <li>当计数器变为0的时候，<code>await()</code>方法会返回</li></ol> <h2 id="第17天-juc中的循环栅栏cyclicbarrier常见的6种使用场景及代码示例"><a href="#第17天-juc中的循环栅栏cyclicbarrier常见的6种使用场景及代码示例" class="header-anchor">$</a> 第17天：JUC中的循环栅栏CyclicBarrier常见的6种使用场景及代码示例</h2> <p>CyclicBarrier通常称为循环屏障。它和CountDownLatch很相似，都可以使线程先等待然后再执行。不过CountDownLatch是使一批线程等待另一批线程执行完后再执行；而CyclicBarrier只是使等待的线程达到一定数目后再让它们继续执行。</p> <p>CyclicBarrier还有几点需要注意的地方:</p> <ul><li>CyclicBarrier的计数器可以重置而CountDownLatch不行，这意味着CyclicBarrier实例可以被重复使用而CountDownLatch只能被使用一次。而这也是循环屏障循环二字的语义所在。</li> <li>CyclicBarrier允许用户自定义barrierAction操作，这是个可选操作，可以在创建CyclicBarrier对象时指定</li></ul> <blockquote><p>CyclicBarrier内部相当于有个计数器（构造方法传入的），每次调用<code>await();</code>后，计数器会减1，并且await()方法会让当前线程阻塞，等待计数器减为0的时候，所有在await()上等待的线程被唤醒，然后继续向下执行，此时计数器又会被还原为创建时的值，然后可以继续再次使用。</p></blockquote> <p><strong>结论：</strong></p> <ol><li><strong>内部有一个人把规则破坏了（接收到中断信号），其他人都不按规则来了，不会等待了</strong></li> <li><strong>接收到中断信号的线程，await方法会触发InterruptedException异常，然后被唤醒向下运行</strong></li> <li><strong>其他等待中 或者后面到达的线程，会在await()方法上触发<code>BrokenBarrierException</code>异常，然后继续执行</strong></li></ol> <h2 id="第18天-玩转java线程池-这一篇就够了"><a href="#第18天-玩转java线程池-这一篇就够了" class="header-anchor">$</a> 第18天：玩转java线程池，这一篇就够了</h2> <p><code>java.util.concurrent.ThreadPoolExecutor</code>，主要构造方法参数：</p> <p><strong>corePoolSize</strong>：核心线程大小，当提交一个任务到线程池时，线程池会创建一个线程来执行任务，即使有其他空闲线程可以处理任务也会创新线程，等到工作的线程数大于核心线程数时就不会在创建了。如果调用了线程池的<code>prestartAllCoreThreads</code>方法，线程池会提前把核心线程都创造好，并启动</p> <p><strong>maximumPoolSize</strong>：线程池允许创建的最大线程数。如果队列满了，并且以创建的线程数小于最大线程数，则线程池会再创建新的线程执行任务。如果我们使用了无界队列，那么所有的任务会加入队列，这个参数就没有什么效果了</p> <p><strong>keepAliveTime</strong>：线程池的工作线程空闲后，保持存活的时间。如果没有任务处理了，有些线程会空闲，空闲的时间超过了这个值，会被回收掉。如果任务很多，并且每个任务的执行时间比较短，避免线程重复创建和回收，可以调大这个时间，提高线程的利用率</p> <p><strong>unit</strong>：keepAliveTIme的时间单位，可以选择的单位有天、小时、分钟、毫秒、微妙、千分之一毫秒和纳秒。类型是一个枚举<code>java.util.concurrent.TimeUnit</code>，这个枚举也经常使用，有兴趣的可以看一下其源码</p> <p><strong>workQueue</strong>：工作队列，用于缓存待处理任务的阻塞队列，常见的有4种，本文后面有介绍</p> <p><strong>threadFactory</strong>：线程池中创建线程的工厂，可以通过线程工厂给每个创建出来的线程设置更有意义的名字</p> <p><strong>handler</strong>：饱和策略，当线程池无法处理新来的任务了，那么需要提供一种策略处理提交的新任务，默认有4种策略，文章后面会提到</p> <p><strong>调用线程池的execute方法处理任务，执行execute方法的过程：</strong></p> <ol><li>判断线程池中运行的线程数是否小于corepoolsize，是：则创建新的线程来处理任务，否：执行下一步</li> <li>试图将任务添加到workQueue指定的队列中，如果无法添加到队列，进入下一步</li> <li>判断线程池中运行的线程数是否小于<code>maximumPoolSize</code>，是：则新增线程处理当前传入的任务，否：将任务传递给<code>handler</code>对象<code>rejectedExecution</code>方法处理</li></ol> <p><strong>线程池中的2个关闭方法：</strong></p> <p>调用<code>shutdown</code>方法之后，线程池将不再接口新任务，内部会将所有已提交的任务处理完毕，处理完毕之后，工作线程自动退出。</p> <p>而调用<code>shutdownNow</code>方法后，线程池会将还未处理的（在队里等待处理的任务）任务移除，将正在处理中的处理完毕之后，工作线程自动退出。</p> <p><strong>扩展线程池：</strong></p> <p><code>ThreadPoolExecutor</code>内部提供了几个方法<code>beforeExecute</code>、<code>afterExecute</code>、<code>terminated</code>，可以由开发人员自己去这些方法。</p> <p>合理地配置线程池：</p> <p>Java Concurrency inPractice书中给出了估算线程池大小的公式：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Ncpu</span> <span class="token operator">=</span> <span class="token constant">CUP</span>的数量
<span class="token class-name">Ucpu</span> <span class="token operator">=</span> 目标<span class="token constant">CPU</span>的使用率，<span class="token number">0</span><span class="token operator">&lt;=</span><span class="token class-name">Ucpu</span><span class="token operator">&lt;=</span><span class="token number">1</span>
<span class="token class-name">W</span><span class="token operator">/</span><span class="token class-name">C</span> <span class="token operator">=</span> 等待时间与计算时间的比例
为保存处理器达到期望的使用率，最有的线程池的大小等于：
<span class="token class-name">Nthreads</span> <span class="token operator">=</span> <span class="token class-name">Ncpu</span> × <span class="token class-name">Ucpu</span> × <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token class-name">W</span><span class="token operator">/</span><span class="token class-name">C</span><span class="token punctuation">)</span>
</code></pre></div><ol><li><p><strong>线程池中的所有线程超过了空闲时间都会被销毁么？</strong></p> <p>如果allowCoreThreadTimeOut为true，超过了空闲时间的所有线程都会被回收，不过这个值默认是false，系统会保留核心线程，其他的会被回收</p></li> <li><p><strong>空闲线程是如何被销毁的？</strong></p> <p>所有运行的工作线程会尝试从队列中获取任务去执行，超过一定时间（keepAliveTime）还没有拿到任务，自己主动退出</p></li> <li><p><strong>核心线程在线程池创建的时候会初始化好么？</strong></p> <p>默认情况下，核心线程不会进行初始化，在刚开始调用线程池执行任务的时候，传入一个任务会创建一个线程，直到达到核心线程数。不过可以在创建线程池之后，调用其<code>prestartAllCoreThreads</code>提前将核心线程创建好。</p></li></ol> <h2 id="第19天-juc中的executor框架详解1"><a href="#第19天-juc中的executor框架详解1" class="header-anchor">$</a> 第19天：JUC中的Executor框架详解1</h2> <p><strong>Executors框架包括：</strong></p> <ul><li>Executor</li> <li>ExecutorService</li> <li>ThreadPoolExecutor</li> <li>Executors</li> <li>Future</li> <li>Callable</li> <li>FutureTask</li> <li>CompletableFuture</li> <li>CompletionService</li> <li>ExecutorCompletionService</li></ul> <p>ExecutorService有三种状态：运行、关闭、终止。创建后便进入运行状态，当调用了shutdown()方法时，便进入了关闭状态，此时意味着ExecutorService不再接受新的任务，但是他还是会执行已经提交的任务，当所有已经提交了的任务执行完后，便达到终止状态。如果不调用shutdown方法，ExecutorService方法会一直运行下去，系统一般不会主动关闭。</p> <p>假设系统调用scheduleAtFixedRate的时间是T1，那么执行时间如下：</p> <p>第1次：T1+initialDelay，执行结束时间：E1</p> <p>第2次：E1+period，执行结束时间：E2</p> <p>第3次：E2+period，执行结束时间：E3</p> <p>第4次：E3+period，执行结束时间：E4</p> <p>第n次：上次执行结束时间+period</p> <p><strong>定时任务有异常会怎么样？</strong></p> <p>发生异常之后没有任何现象，被ScheduledExecutorService内部给吞掉了，然后这个任务再也不会执行了，<code>scheduledFuture.isDone()</code>输出true，表示这个任务已经结束了，再也不会被执行了。</p> <h2 id="第20天-juc中的executor框架详解2之executorcompletionservice"><a href="#第20天-juc中的executor框架详解2之executorcompletionservice" class="header-anchor">$</a> 第20天：JUC中的Executor框架详解2之ExecutorCompletionService</h2> <p>CompletionService相当于一个执行任务的服务，通过submit丢任务给这个服务，服务内部去执行任务，可以通过服务提供的一些方法获取服务中已经完成的任务。</p> <p>ExecutorCompletionService类是CompletionService接口的具体实现。</p> <p>说一下其内部原理，ExecutorCompletionService创建的时候会传入一个线程池，调用submit方法传入需要执行的任务，任务由内部的线程池来处理；ExecutorCompletionService内部有个阻塞队列，任意一个任务完成之后，会将任务的执行结果（Future类型）放入阻塞队列中，然后其他线程可以调用它take、poll方法从这个阻塞队列中获取一个已经完成的任务，获取任务返回结果的顺序和任务执行完成的先后顺序一致，所以最先完成的任务会先返回。</p> <p>ExecutorCompletionService提供了获取一批任务中最先完成的任务结果的能力。</p> <h2 id="第21天-java中的cas操作-java并发的基石"><a href="#第21天-java中的cas操作-java并发的基石" class="header-anchor">$</a> 第21天：java中的CAS操作，java并发的基石</h2> <p>系统底层进行CAS操作的时候，会判断当前系统是否为多核系统，如果是就给总线加锁，只有一个线程会对总线加锁成功，加锁成功之后会执行cas操作，也就是说CAS的原子性实际上是CPU实现的， 其实在这一点上还是有排他锁的.，只是比起用synchronized， 这里的排他时间要短的多， 所以在多线程情况下性能会比较好。</p> <p>CAS需要在操作值的时候检查下值有没有发生变化，如果没有发生变化则更新，但是如果一个值原来是A，变成了B，又变成了A，那么使用CAS进行检查时会发现它的值没有发生变化，但是实际上却变化了。这就是CAS的ABA问题。 常见的解决思路是使用版本号。在变量前面追加上版本号，每次变量更新的时候把版本号加一，那么A-B-A 就会变成1A-2B-3A。 目前在JDK的atomic包里提供了一个类AtomicStampedReference来解决ABA问题。这个类的compareAndSet方法作用是首先检查当前引用是否等于预期引用，并且当前标志是否等于预期标志，如果全部相等，则以原子方式将该引用和该标志的值设置为给定的更新值。</p> <h2 id="第22天-java中底层工具类unsafe-高手必须要了解"><a href="#第22天-java中底层工具类unsafe-高手必须要了解" class="header-anchor">$</a> 第22天：java中底层工具类Unsafe，高手必须要了解</h2> <p>Unsafe类方法：</p> <ul><li>CAS</li> <li>数组相关
<ul><li>返回数组元素内存大小</li> <li>返回数组首元素偏移地址</li></ul></li> <li>内存屏障
<ul><li>禁止Load，Store重排序</li></ul></li> <li>内存操作
<ul><li>分配、拷贝、释放堆外内存</li> <li>设置、获得给定地址中的值</li></ul></li> <li>系统相关
<ul><li>返回内存页大小</li> <li>返回系统指针大小</li></ul></li> <li>线程调度
<ul><li>线程挂起恢复</li> <li>获取、释放锁</li></ul></li> <li>Class相关
<ul><li>动态创建类（普通类、匿名类）</li> <li>获取field的内存地址偏移</li> <li>检测、确保类初始化</li></ul></li> <li>对象操作
<ul><li>获取对象成员属性内存偏移量</li> <li>非常规对象实例化
<ul><li>存储、获取指定偏移地址的变量值（包含延迟生效、volatile语义）</li></ul></li></ul></li></ul> <h3 id="cas操作相关方法"><a href="#cas操作相关方法" class="header-anchor">$</a> CAS操作相关方法</h3> <div class="language- extra-class"><pre class="language-text"><code>public final native boolean compareAndSwapInt(Object o, long offset, int expected,int update);
public final native boolean compareAndSwapLong(Object o, long offset, long expected, long update);
public final native boolean compareAndSwapObject(Object o, long offset, Object expected, Object update);
</code></pre></div><blockquote><p>Unsafe提供的CAS方法（如compareAndSwapXXX）底层实现即为CPU指令cmpxchg。执行cmpxchg指令的时候，会判断当前系统是否为多核系统，如果是就给总线加锁，只有一个线程会对总线加锁成功，加锁成功之后会执行cas操作，也就是说CAS的原子性实际上是CPU实现的， 其实在这一点上还是有排他锁的，只是比起用synchronized， 这里的排他时间要短的多， 所以在多线程情况下性能会比较好。</p> <p>说一下offset，offeset为字段的偏移量，每个对象有个地址，offset是字段相对于对象地址的偏移量，对象地址记为baseAddress，字段偏移量记为offeset，那么字段对应的实际地址就是baseAddress+offeset，所以cas通过对象、偏移量就可以去操作字段对应的值了。</p></blockquote> <h3 id="原子操作相关方法"><a href="#原子操作相关方法" class="header-anchor">$</a> 原子操作相关方法</h3> <div class="language- extra-class"><pre class="language-text"><code>public final int getAndAddInt(Object o, long offset, int delta);
public final long getAndAddLong(Object o, long offset, long delta);
public final int getAndSetInt(Object o, long offset, int newValue);
public final long getAndSetLong(Object o, long offset, long newValue);
public final Object getAndSetObject(Object o, long offset, Object newValue);
</code></pre></div><h3 id="线程调度相关方法"><a href="#线程调度相关方法" class="header-anchor">$</a> 线程调度相关方法</h3> <div class="language- extra-class"><pre class="language-text"><code>public native void unpark(Object thread);
public native void park(boolean isAbsolute, long time);
@Deprecated public native void monitorEnter(Object o);
@Deprecated public native void monitorExit(Object o);
@Deprecated public native boolean tryMonitorEnter(Object o);
</code></pre></div><blockquote><p>被关键字volatile修饰的数据，有2点语义：</p> <ol><li>如果一个变量被volatile修饰，读取这个变量时候，会强制从主内存中读取，然后将其复制到当前线程的工作内存中使用</li> <li>给volatile修饰的变量赋值的时候，会强制将赋值的结果从工作内存刷新到主内存</li></ol> <p>上面2点语义保证了被volatile修饰的数据在多线程中的可见性。</p></blockquote> <h3 id="保证变量的可见性"><a href="#保证变量的可见性" class="header-anchor">$</a> 保证变量的可见性</h3> <div class="language- extra-class"><pre class="language-text"><code>public native void  putIntVolatile(Object o, long offset, int x);
public native int getIntVolatile(Object o, long offset);
</code></pre></div><h3 id="class相关方法"><a href="#class相关方法" class="header-anchor">$</a> Class相关方法</h3> <div class="language- extra-class"><pre class="language-text"><code>//获取给定静态字段的内存地址偏移量，这个值对于给定的字段是唯一且固定不变的
public native long staticFieldOffset(Field f);
//获取一个静态类中给定字段的对象指针
public native Object staticFieldBase(Field f);
//判断是否需要初始化一个类，通常在获取一个类的静态属性的时候（因为一个类如果没初始化，它的静态属性也不会初始化）使用。 当且仅当ensureClassInitialized方法不生效时返回false。
public native boolean shouldBeInitialized(Class&lt;?&gt; c);
//检测给定的类是否已经初始化。通常在获取一个类的静态属性的时候（因为一个类如果没初始化，它的静态属性也不会初始化）使用。
public native void ensureClassInitialized(Class&lt;?&gt; c);
//定义一个类，此方法会跳过JVM的所有安全检查，默认情况下，ClassLoader（类加载器）和ProtectionDomain（保护域）实例来源于调用者
public native Class&lt;?&gt; defineClass(String name, byte[] b, int off, int len, ClassLoader loader, ProtectionDomain protectionDomain);
//定义一个匿名类
public native Class&lt;?&gt; defineAnonymousClass(Class&lt;?&gt; hostClass, byte[] data, Object[] cpPatches);
</code></pre></div><h3 id="对象操作的其他方法"><a href="#对象操作的其他方法" class="header-anchor">$</a> 对象操作的其他方法</h3> <div class="language- extra-class"><pre class="language-text"><code>//返回对象成员属性在内存地址相对于此对象的内存地址的偏移量
public native long objectFieldOffset(Field f);
//获得给定对象的指定地址偏移量的值，与此类似操作还有：getInt，getDouble，getLong，getChar等
public native Object getObject(Object o, long offset);
//给定对象的指定地址偏移量设值，与此类似操作还有：putInt，putDouble，putLong，putChar等
public native void putObject(Object o, long offset, Object x);
//从对象的指定偏移量处获取变量的引用，使用volatile的加载语义
public native Object getObjectVolatile(Object o, long offset);
//存储变量的引用到对象的指定的偏移量处，使用volatile的存储语义
public native void putObjectVolatile(Object o, long offset, Object x);
//有序、延迟版本的putObjectVolatile方法，不保证值的改变被其他线程立即看到，只有在field被volatile修饰符修饰时有效
public native void putOrderedObject(Object o, long offset, Object x);
//绕过构造方法、初始化代码来创建对象
public native Object allocateInstance(Class&lt;?&gt; cls) throws InstantiationException;
</code></pre></div><h3 id="数组相关的一些方法"><a href="#数组相关的一些方法" class="header-anchor">$</a> 数组相关的一些方法</h3> <div class="language- extra-class"><pre class="language-text"><code>//返回数组中第一个元素的偏移地址
public native int arrayBaseOffset(Class&lt;?&gt; arrayClass);
//返回数组中一个元素占用的大小
public native int arrayIndexScale(Class&lt;?&gt; arrayClass);
</code></pre></div><h3 id="内存屏障相关操作"><a href="#内存屏障相关操作" class="header-anchor">$</a> 内存屏障相关操作</h3> <div class="language- extra-class"><pre class="language-text"><code>//内存屏障，禁止load操作重排序。屏障前的load操作不能被重排序到屏障后，屏障后的load操作不能被重排序到屏障前
public native void loadFence();
//内存屏障，禁止store操作重排序。屏障前的store操作不能被重排序到屏障后，屏障后的store操作不能被重排序到屏障前
public native void storeFence();
//内存屏障，禁止load、store操作重排序
public native void fullFence();
</code></pre></div><h2 id="第23天-juc中原子类-一篇就够了"><a href="#第23天-juc中原子类-一篇就够了" class="header-anchor">$</a> 第23天：JUC中原子类，一篇就够了</h2> <h3 id="基本类型原子类"><a href="#基本类型原子类" class="header-anchor">$</a> 基本类型原子类</h3> <ul><li>AtomicInteger</li> <li>AtomicLong</li> <li>AtomicBoolean</li></ul> <p>AtomicInteger 类常用方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//获取当前的值</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> newValue<span class="token punctuation">)</span><span class="token comment">//获取当前的值，并设置新的值</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//获取当前的值，并自增</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndDecrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//获取当前的值，并自减</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndAdd</span><span class="token punctuation">(</span><span class="token keyword">int</span> delta<span class="token punctuation">)</span> <span class="token comment">//获取当前的值，并加上预期的值</span>
<span class="token keyword">boolean</span> <span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> expect<span class="token punctuation">,</span> <span class="token keyword">int</span> update<span class="token punctuation">)</span> <span class="token comment">//如果输入的数值等于预期值，则以原子方式将该值设置为输入值（update）</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">lazySet</span><span class="token punctuation">(</span><span class="token keyword">int</span> newValue<span class="token punctuation">)</span><span class="token comment">//最终设置为newValue,使用 lazySet 设置之后可能导致其他线程在之后的一小段时间内还是可以读到旧的值。</span>
</code></pre></div><h3 id="数组类型原子类"><a href="#数组类型原子类" class="header-anchor">$</a> 数组类型原子类</h3> <ul><li>AtomicIntegerArray</li> <li>AtomicLongArray</li> <li>AtomicReferenceArray</li></ul> <p>AtomicIntegerArray 类常用方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token comment">//获取 index=i 位置元素的值</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> newValue<span class="token punctuation">)</span><span class="token comment">//返回 index=i 位置的当前的值，并将其设置为新值：newValue</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token comment">//获取 index=i 位置元素的值，并让该位置的元素自增</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndDecrement</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token comment">//获取 index=i 位置元素的值，并让该位置的元素自减</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndAdd</span><span class="token punctuation">(</span><span class="token keyword">int</span> delta<span class="token punctuation">)</span> <span class="token comment">//获取 index=i 位置元素的值，并加上预期的值</span>
<span class="token keyword">boolean</span> <span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> expect<span class="token punctuation">,</span> <span class="token keyword">int</span> update<span class="token punctuation">)</span> <span class="token comment">//如果输入的数值等于预期值，则以原子方式将 index=i 位置的元素值设置为输入值（update）</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">lazySet</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> newValue<span class="token punctuation">)</span><span class="token comment">//最终 将index=i 位置的元素设置为newValue,使用 lazySet 设置之后可能导致其他线程在之后的一小段时间内还是可以读到旧的值。</span>
</code></pre></div><h2 id="第24天-threadlocal、inheritablethreadlocal-通俗易懂"><a href="#第24天-threadlocal、inheritablethreadlocal-通俗易懂" class="header-anchor">$</a> 第24天：ThreadLocal、InheritableThreadLocal（通俗易懂）</h2> <p>略</p> <h2 id="第25天-掌握juc中的阻塞队列"><a href="#第25天-掌握juc中的阻塞队列" class="header-anchor">$</a> 第25天：掌握JUC中的阻塞队列</h2> <p>BlockingQueue常见的实现类：</p> <ul><li>ArrayBlockingQueue</li> <li>LinkedBlockingQueue</li> <li>PriorityBlockingQueue</li> <li>SynchronousQueue</li> <li>DelayQueue</li> <li>LinkedTransferQueue</li></ul> <h2 id="第26篇-学会使用juc中常见的集合-常看看"><a href="#第26篇-学会使用juc中常见的集合-常看看" class="header-anchor">$</a> 第26篇：学会使用JUC中常见的集合，常看看！</h2> <table><thead><tr><th>集合类</th> <th>特性</th></tr></thead> <tbody><tr><td>ConcurrentHashMap</td> <td>内部使用红黑树实现的</td></tr> <tr><td>ConcurrentSkipListMap</td> <td>内部使用跳表实现的，放入的元素会进行排序</td></tr> <tr><td>ConcurrentSkipListSet</td> <td>有序的Set，内部基于ConcurrentSkipListMap实现的</td></tr> <tr><td>CopyOnWriteArrayList</td> <td>元素不重复</td></tr> <tr><td>CopyOnWriteArraySet</td> <td>内部使用CopyOnWriteArrayList实现的</td></tr> <tr><td>ConcurrentLinkedQueue</td> <td></td></tr> <tr><td>ConcurrentLinkedDeque</td> <td></td></tr></tbody></table> <h3 id="deque接口"><a href="#deque接口" class="header-anchor">$</a> Deque接口</h3> <p>双向队列是指该队列两端的元素既能入队(offer)也能出队(poll)：</p> <ul><li><p>如果将Deque限制为只能从一端入队和出队，则可实现栈的数据结构。</p></li> <li><p>在将双端队列用作队列时，将得到 FIFO（先进先出）行为。</p></li></ul> <p>下表总结了上述 12 种方法：</p> <table><thead><tr><th></th> <th>头部</th> <th>头部</th> <th>尾部</th> <th>尾部</th></tr></thead> <tbody><tr><td></td> <td><em>抛出异常</em></td> <td><em>特殊值</em></td> <td><em>抛出异常</em></td> <td><em>特殊值</em></td></tr> <tr><td><strong>插入</strong></td> <td><code>addFirst(e)</code></td> <td><code>offerFirst(e)</code></td> <td><code>addLast(e)</code></td> <td><code>offerLast(e)</code></td></tr> <tr><td><strong>移除</strong></td> <td><code>removeFirst()</code></td> <td><code>pollFirst()</code></td> <td><code>removeLast()</code></td> <td><code>pollLast()</code></td></tr> <tr><td><strong>检查</strong></td> <td><code>getFirst()</code></td> <td><code>peekFirst()</code></td> <td><code>getLast()</code></td> <td><code>peekLast()</code></td></tr></tbody></table> <h2 id="第27天-实战篇-接口性能成倍提升-让同事刮目相看-现学现用"><a href="#第27天-实战篇-接口性能成倍提升-让同事刮目相看-现学现用" class="header-anchor">$</a> 第27天：实战篇，接口性能成倍提升，让同事刮目相看，现学现用</h2> <h2 id="第28天-实战篇-微服务日志的伤痛-一并帮你解决掉"><a href="#第28天-实战篇-微服务日志的伤痛-一并帮你解决掉" class="header-anchor">$</a> 第28天：实战篇，微服务日志的伤痛，一并帮你解决掉</h2> <h2 id="第29天-高并发中常见的限流方式"><a href="#第29天-高并发中常见的限流方式" class="header-anchor">$</a> 第29天：高并发中常见的限流方式</h2> <h3 id="常见的限流算法"><a href="#常见的限流算法" class="header-anchor">$</a> 常见的限流算法</h3> <h4 id="通过控制最大并发数来进行限流"><a href="#通过控制最大并发数来进行限流" class="header-anchor">$</a> 通过控制最大并发数来进行限流</h4> <p>JUC中提供了这样的工具类：Semaphore</p> <h4 id="使用漏桶算法来进行限流"><a href="#使用漏桶算法来进行限流" class="header-anchor">$</a> 使用漏桶算法来进行限流</h4> <p>漏桶算法思路很简单，水（请求）先进入到漏桶里，漏桶以一定的速度出水，当水流入速度过大会直接溢出。可以看出漏桶算法能强行限制数据的传输速率。</p> <h4 id="使用令牌桶算法来进行限流"><a href="#使用令牌桶算法来进行限流" class="header-anchor">$</a> 使用令牌桶算法来进行限流</h4> <p>令牌桶算法的原理是系统以恒定的速率产生令牌，然后把令牌放到令牌桶中，令牌桶有一个容量，当令牌桶满了的时候，再向其中放令牌，那么多余的令牌会被丢弃；当想要处理一个请求的时候，需要从令牌桶中取出一个令牌，如果此时令牌桶中没有令牌，那么则拒绝该请求。从原理上看，令牌桶算法和漏桶算法是相反的，一个“进水”，一个是“漏水”。这种算法可以应对突发程度的请求，因此比漏桶算法好。</p> <h4 id="限流工具类ratelimiter"><a href="#限流工具类ratelimiter" class="header-anchor">$</a> 限流工具类RateLimiter</h4> <p>Google开源工具包Guava提供了限流工具类RateLimiter，可以非常方便的控制系统每秒吞吐量。</p> <h2 id="第30天-juc中工具类completablefuture-必备技能"><a href="#第30天-juc中工具类completablefuture-必备技能" class="header-anchor">$</a> 第30天：JUC中工具类CompletableFuture，必备技能</h2> <h3 id="completionstage接口"><a href="#completionstage接口" class="header-anchor">$</a> CompletionStage接口</h3> <p>CompletionStage代表异步计算过程中的某一个阶段，一个阶段完成以后可能会触发另外一个阶段。</p> <h3 id="completablefuture类"><a href="#completablefuture类" class="header-anchor">$</a> CompletableFuture类</h3> <p>CompletableFuture 提供了四个静态方法来创建一个异步操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当CompletableFuture的计算结果完成，或者抛出异常的时候，可以执行特定的Action。主要是下面的方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">whenCompleteAsync</span><span class="token punctuation">(</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">whenCompleteAsync</span><span class="token punctuation">(</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">exceptionally</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Throwable</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当一个线程依赖另一个线程时，可以使用 thenApply 方法来把这两个线程串行化：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>handle 方法和 thenApply 方法处理方式基本一样。不同的是 handle 还可以处理异常的任务。thenApply 只可以执行正常的任务，任务出现异常则不执行 thenApply 方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleAsync</span><span class="token punctuation">(</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleAsync</span><span class="token punctuation">(</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>接收任务的处理结果，并消费处理，无返回结果：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAccept</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>跟 thenAccept 方法不一样的是，不关心任务的处理结果。只要上面的任务执行完成，就开始执行 thenAccept ：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenRun</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> action<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>thenCombine 会把 两个 CompletionStage 的任务都执行完成后，把两个任务的结果一块交给 thenCombine 来处理：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenCombine</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenCombineAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenCombineAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当两个CompletionStage都执行完成后，把结果一块交给thenAcceptBoth来进行消费：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptBoth</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptBothAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptBothAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>两个CompletionStage，谁执行返回的结果快，我就用那个CompletionStage的结果进行下一步的转化操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">applyToEither</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">applyToEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">applyToEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>两个CompletionStage，谁执行返回的结果快，我就用那个CompletionStage的结果进行下一步的消耗操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">acceptEither</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">acceptEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">acceptEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>两个CompletionStage，任何一个完成了都会执行下一步的操作（Runnable）：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterEither</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>两个CompletionStage，都完成了才会执行下一步的操作（Runnable）：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterBoth</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterBothAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterBothAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>thenCompose 方法允许你对两个 CompletionStage 进行流水线操作，第一个操作完成时，将其结果作为参数传递给第二个操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenCompose</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">CompletionStage</span><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenComposeAsync</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">CompletionStage</span><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenComposeAsync</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">CompletionStage</span><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="第31天-获取线程执行结果-这6种方法你都知道"><a href="#第31天-获取线程执行结果-这6种方法你都知道" class="header-anchor">$</a> 第31天：获取线程执行结果，这6种方法你都知道？</h2> <p>在一个线程中需要获取其他线程的执行结果，能想到几种方式？各有什么优缺点？</p> <h3 id="方式1-thread的join-方法实现"><a href="#方式1-thread的join-方法实现" class="header-anchor">$</a> 方式1：Thread的join()方法实现</h3> <p>join的方式，只能阻塞一个线程，如果其他线程中也需要获取thread线程的执行结果，join方法无能为力了。</p> <h3 id="方式2-countdownlatch实现"><a href="#方式2-countdownlatch实现" class="header-anchor">$</a> 方式2：CountDownLatch实现</h3> <p>使用CountDownLatch可以让一个或者多个线程等待一批线程完成之后，自己再继续；</p> <h3 id="方式3-executorservice-submit方法实现"><a href="#方式3-executorservice-submit方法实现" class="header-anchor">$</a> 方式3：ExecutorService.submit方法实现</h3> <p>使用<code>ExecutorService.submit</code>方法实现的，此方法返回一个<code>Future</code>，<code>future.get()</code>会让当前线程阻塞，直到Future关联的任务执行完毕。</p> <h3 id="方式4-futuretask方式1"><a href="#方式4-futuretask方式1" class="header-anchor">$</a> 方式4：FutureTask方式1</h3> <h3 id="方式5-futuretask方式2"><a href="#方式5-futuretask方式2" class="header-anchor">$</a> 方式5：FutureTask方式2</h3> <h3 id="方式6-completablefuture方式实现"><a href="#方式6-completablefuture方式实现" class="header-anchor">$</a> 方式6：CompletableFuture方式实现</h3> <h2 id="第32天-高并发中计数器的实现方式有哪些"><a href="#第32天-高并发中计数器的实现方式有哪些" class="header-anchor">$</a> 第32天：高并发中计数器的实现方式有哪些？</h2> <h3 id="方式1-synchronized方式实现"><a href="#方式1-synchronized方式实现" class="header-anchor">$</a> 方式1：synchronized方式实现</h3> <h3 id="方式2-atomiclong实现"><a href="#方式2-atomiclong实现" class="header-anchor">$</a> 方式2：AtomicLong实现</h3> <h3 id="方式3-longadder实现"><a href="#方式3-longadder实现" class="header-anchor">$</a> 方式3：LongAdder实现</h3> <p>LongAdder在并发量比较大的情况下，操作数据的时候，相当于把这个数字分成了很多份数字，然后交给多个人去管控，每个管控者负责保证部分数字在多线程情况下操作的正确性。当多线程访问的时，通过hash算法映射到具体管控者去操作数据，最后再汇总所有的管控者的数据，得到最终结果。相当于降低了并发情况下锁的粒度，所以效率比较高。</p> <h3 id="方式4-longaccumulator实现"><a href="#方式4-longaccumulator实现" class="header-anchor">$</a> 方式4：LongAccumulator实现</h3> <p>LongAccumulator是LongAdder的功能增强版。LongAdder的API只有对数值的加减，而LongAccumulator提供了自定义的函数操作。</p> <h2 id="参考"><a href="#参考" class="header-anchor">$</a> 参考</h2> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933019&amp;idx=1&amp;sn=3455877c451de9c61f8391ffdc1eb01d&amp;chksm=88621aa5bf1593b377e2f090bf37c87ba60081fb782b2371b5f875e4a6cadc3f92ff6d747e32&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">
第1天:必须知道的几个概念<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933024&amp;idx=1&amp;sn=969bfa5e2c3708e04adaf6401503c187&amp;chksm=88621a9ebf1593886dd3f0f5923b6f929eade0b43204b98a8d0622a5f542deff4f6a633a13c8&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第2天:并发级别<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933041&amp;idx=1&amp;sn=82af7c702f737782118a9141858117d1&amp;chksm=88621a8fbf159399be1d4834f6f845fa530b94a4ca7c0eaa61de508f725ad0fab74b074d73be&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第3天:有关并行的两个重要定律<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933050&amp;idx=1&amp;sn=497c4de99086f95bed11a4317a51e6a6&amp;chksm=88621a84bf159392c9e3e243355313c397e0658df6b88769cdd182cb5d39b6f25686c86beffc&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第4天:JMM相关的一些概念<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933069&amp;idx=1&amp;sn=82105bb5b759ec8b1f3a69062a22dada&amp;chksm=88621af3bf1593e5ece7c1da3df3b4be575271a2eaca31c784591ed0497252caa1f6a6ec0545&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第5天:深入理解进程和线程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933082&amp;idx=1&amp;sn=e940c4f94a8c1527b6107930eefdcd00&amp;chksm=88621ae4bf1593f270991e6f6bac5769ea850fa02f11552d1aa91725f4512d4f1ff8f18fcdf3&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第6天:线程的基本操作<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933088&amp;idx=1&amp;sn=f1d666dd799664b1989c77441b9d12c5&amp;chksm=88621adebf1593c83501ac33d6a0e0de075f2b2e30caf986cf276cbb1c8dff0eac2a0a648b1d&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第7天:volatile与Java内存模型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933095&amp;idx=1&amp;sn=d32242a5ec579f45d1e9becf44bff069&amp;chksm=88621ad9bf1593cf00b574a8e0feeffbb2c241c30b01ebf5749ccd6b7b64dcd2febbd3000581&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第8天:线程组<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933102&amp;idx=1&amp;sn=5255e94dc2649003e01bf3d61762c593&amp;chksm=88621ad0bf1593c6905e75a82aaf6e39a0af338362366ce2860ee88c1b800e52f5c6529c089c&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第9天：用户线程和守护线程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933107&amp;idx=1&amp;sn=6b9fbdfa180c2ca79703e0ca1b524b77&amp;chksm=88621acdbf1593dba5fa5a0092d810004362e9f38484ffc85112a8c23ef48190c51d17e06223&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第10天:线程安全和synchronized关键字<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933111&amp;idx=1&amp;sn=0a3592e41e59d0ded4a60f8c1b59e82e&amp;chksm=88621ac9bf1593df5f8342514d6750cc8a833ba438aa208cf128493981ba666a06c4037d84fb&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第11天:线程中断的几种方式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933116&amp;idx=1&amp;sn=83ae2d1381e3b8a425e65a9fa7888d38&amp;chksm=88621ac2bf1593d4de1c5f6905c31c7d88ac4b53c0c5c071022ba2e25803fc734078c1de589c&amp;token=2041017112&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第12天JUC:ReentrantLock重入锁<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933120&amp;idx=1&amp;sn=63ffe3ff64dcaf0418816febfd1e129a&amp;chksm=88621b3ebf159228df5f5a501160fafa5d87412a4f03298867ec9325c0be57cd8e329f3b5ad1&amp;token=476165288&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第13天:JUC中的Condition对象<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933125&amp;idx=1&amp;sn=382528aeb341727bafb02bb784ff3d4f&amp;chksm=88621b3bbf15922d93bfba11d700724f1e59ef8a74f44adb7e131a4c3d1465f0dc539297f7f3&amp;token=1338873010&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第14天:JUC中的LockSupport工具类，必备技能<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933130&amp;idx=1&amp;sn=cecc6bd906e79a86510c1fbb0e66cd21&amp;chksm=88621b34bf159222042da8ed4b633e94ca04a614d290d54a952a668459a339ebec0c754d562d&amp;token=702505185&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第15天：JUC中的Semaphore（信号量）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933134&amp;idx=1&amp;sn=65c2b9982bb6935c54ff33082f9c111f&amp;chksm=88621b30bf159226d41607292a1dc83186f8928744dbc44acfda381266fa2cdc006177b44095&amp;token=773938509&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第16天：JUC中等待多线程完成的工具类CountDownLatch，必备技能<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933144&amp;idx=1&amp;sn=7f0cddc92ff39835ea6652ebb3186dbf&amp;chksm=88621b26bf15923039933b127c19f39a76214fb1d5daa7ad0eee77f961e2e3ab5f5ca3f48740&amp;token=773938509&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第17天：JUC中的循环栅栏CyclicBarrier的6种使用场景<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933151&amp;idx=1&amp;sn=2020066b974b5f4c0823abd419e8adae&amp;chksm=88621b21bf159237bdacfb47bd1a344f7123aabc25e3607e78d936dd554412edce5dd825003d&amp;token=995072421&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第18天：JAVA线程池，这一篇就够了<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933156&amp;idx=1&amp;sn=30f7d67b44a952eae98e688bc6035fbd&amp;chksm=88621b1abf15920c7a0705fbe34c4ce92b94b88e08f8ecbcad3827a0950cfe4d95814b61f538&amp;token=995072421&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第19天：JUC中的Executor框架详解1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933160&amp;idx=1&amp;sn=62649485b065f68c0fc59bb502ed42df&amp;chksm=88621b16bf159200d5e25d11ab7036c60e3f923da3212ae4dd148753d02593a45ce0e9b886c4&amp;token=42900009&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第20天：JUC中的Executor框架详解2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933166&amp;idx=1&amp;sn=15e614500676170b76a329efd3255c12&amp;chksm=88621b10bf1592064befc5c9f0d78c56cda25c6d003e1711b85e5bfeb56c9fd30d892178db87&amp;token=1033016931&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第21天：java中的CAS，你需要知道的东西<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933173&amp;idx=1&amp;sn=80eb550294677b0042fc030f90cce109&amp;chksm=88621b0bbf15921d2274a7bf6afde912fec02a4c3ade9cfb50d03cdce73e07e33d08d35a3b27&amp;token=1033016931&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第22天：JUC底层工具类Unsafe，高手必须要了解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933181&amp;idx=1&amp;sn=a1e254365d405cdc2e3b8372ecda65ee&amp;chksm=88621b03bf159215ca696c9f81e228d0544a7598b03fe30436babc95c6a95e848161f61b868c&amp;token=743622661&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第23天：JUC中原子类，一篇就够了<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933186&amp;idx=1&amp;sn=079567e8799e43cb734b833c44055c01&amp;chksm=88621b7cbf15926aace88777445822314d6eed2c1f5559b36cb6a6e181f0e543ee14d832ebc2&amp;token=1963100670&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第24天：ThreadLocal、InheritableThreadLocal（通俗易懂）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933190&amp;idx=1&amp;sn=916f539cb1e695948169a358549227d3&amp;chksm=88621b78bf15926e0a94e50a43651dab0ceb14a1fb6b1d8b9b75e38c6d8ac908e31dd2131ded&amp;token=1963100670&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第25天：掌握JUC中的阻塞队列<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933197&amp;idx=1&amp;sn=1ef33a6403680ee49b3acf22d4a4aa34&amp;chksm=88621b73bf159265c8775bc7d80e44f68bc162b7301f5ac8dce9669d17643934404440b6560f&amp;token=2027319240&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第26篇：学会使用JUC中常见的集合，常看看！<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933201&amp;idx=1&amp;sn=b21aeda79e6e6a825826f08fef14f09e&amp;chksm=88621b6fbf159279a2d9e3f195e1be888a9e20cdf95a637385fbd69b5e4be1a99c193da5a611&amp;token=2027319240&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第27天：实战篇，接口性能提升几倍原来这么简单<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933206&amp;idx=1&amp;sn=a3d66275306774977d95d1781a268f07&amp;chksm=88621b68bf15927ee897c277fbccbef4bf347d31362d7425d09ee1ff3743c4d86a064accc2b1&amp;token=2039914863&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第28天：实战篇，微服务日志的伤痛，一并帮你解决掉<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933212&amp;idx=1&amp;sn=b1e8f65d4673bd3cf64c2d6a00645ba9&amp;chksm=88621b62bf15927422958029a1d240198082104d6e50d15dd33c5d3cf5af2195050b772782ec&amp;token=870491352&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第29天：高并发中常见的限流方式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MTkxMDQ4MQ==&amp;mid=2648933221&amp;idx=1&amp;sn=1af60b8917df6494b7c6b05c9eaebfe7&amp;chksm=88621b5bbf15924d403e66e6d442d6b5897757471368b8d3a28c5de6e264cef104338dba1811&amp;token=2098378399&amp;lang=zh_CN&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">第30天：JUC中工具类CompletableFuture，必备技能<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">8/5/2020, 3:38:52 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java/jdk/java_concurrent_framework.html" class="prev">
        Java并发集合框架
      </a></span> <span class="next"><a href="/java/jdk/unicode.html">
        Unicode学习笔记
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a2246195.js" defer></script><script src="/assets/js/2.a92520c9.js" defer></script><script src="/assets/js/144.9117b752.js" defer></script>
  </body>
</html>
